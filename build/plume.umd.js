var Se=Object.defineProperty;var Re=(l,p,R)=>p in l?Se(l,p,{enumerable:!0,configurable:!0,writable:!0,value:R}):l[p]=R;var _=(l,p,R)=>(Re(l,typeof p!="symbol"?p+"":p,R),R),G=(l,p,R)=>{if(!p.has(l))throw TypeError("Cannot "+R)};var S=(l,p,R)=>(G(l,p,"read from private field"),R?R.call(l):p.get(l)),M=(l,p,R)=>{if(p.has(l))throw TypeError("Cannot add the same private member more than once");p instanceof WeakSet?p.add(l):p.set(l,R)},H=(l,p,R,D)=>(G(l,p,"write to private field"),D?D.call(l,R):p.set(l,R),R);var K=(l,p,R)=>(G(l,p,"access private method"),R);(function(l,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(l=typeof globalThis<"u"?globalThis:l||self,p(l.PlumeJS={}))})(this,function(l){var k,ne;"use strict";const p=new(ne=class{constructor(){M(this,k,void 0);H(this,k,new WeakMap)}register(s,e){if(!S(this,k).get(s))S(this,k).set(s,e);else throw console.error(s),"service already exists"}getService(s){const e=S(this,k).get(s);if(e)return e;throw console.error(s),"service is not a registered service."}clear(){H(this,k,new WeakMap)}},k=new WeakMap,ne),R=s=>!!s&&typeof s.subscribe=="function",D=s=>!!s&&typeof s.then=="function",Q=s=>{const e=s.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return e.length===3?e[1].split(",").map(t=>t.trim()):[]},ae=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),ce=s=>({subscribe:e=>{e(s)}}),le=s=>({subscribe:e=>{Promise.resolve(s).then(t=>{e(t)})}});class F{constructor(){_(this,"_callbacks",[])}asObservable(){return{subscribe:e=>this.subscribe(e)}}subscribe(e){return this._callbacks.push(e),this.unsubscribe}unsubscribe(){this._callbacks=[]}next(e){for(const t of this._callbacks)t(e)}}class X extends F{constructor(t){super();_(this,"_initialValue");this._initialValue=t}subscribe(t){const r=super.subscribe(t);return this.next(this._initialValue),r}}class W{constructor(){_(this,"_subcribers",[])}add(e){this._subcribers.push(e)}unsubscribe(){for(const e of this._subcribers)e();this._subcribers=[]}}const $=s=>R(s)?s:D(s)?le(Promise.resolve(s)):ce(s),B=(s,e,t,r=!1)=>(s.addEventListener(e,t,r),()=>{s.removeEventListener(e,t,r)}),ue=s=>{const e=()=>new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),t=y=>{const m=y.querySelectorAll("script");for(const A of m)A.remove()},r=(y,m)=>{if(m=m.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(y)&&(m.includes("javascript:")||m.includes("data:"))||y.startsWith("on"))return!0},u=y=>{const m=y.attributes;for(const{name:A,value:x}of m)r(A,x)&&y.removeAttribute(A)},i=y=>{const m=y.children;for(const A of m)u(A),i(A)},h=e();return t(h),i(h),h.innerHTML},he=function(s){s.renderCount===1&&queueMicrotask(()=>{s.update(),s.renderCount=0})},de=(s,e)=>{const t=Q(e),r=()=>({get(u,i){const h=Object.prototype.toString.call(u[i]);return["[object Object]","[object Array]"].indexOf(h)>-1&&!("__metadata__"in u[i])?new Proxy(u[i],r()):u[i]},set(u,i,h){return u[i]=h,++s.renderCount,he(s),!0}});return class extends e{constructor(...u){return super(...u),u.forEach((i,h)=>{t[h]&&t[h]!=="undefined"&&(this[t[h]]=i)}),new Proxy(this,r())}}},fe=()=>{let s;return[new Promise(t=>{s=t}),s]},Z=(s,e,t)=>{if(e.length>0){const r=[];for(const h of e)h.prototype.__metadata__.name!=="RENDERER"?r.push(p.getService(h)):r.push(t);const u=Q(s),i=new s(...r);return e.forEach((h,y)=>{i[u[y]]=r[y]}),i}else return new s},j=new class{constructor(){_(this,"globalStyles");_(this,"globalStyleTag");_(this,"style_registry");_(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let e=[];const t=new CSSStyleSheet;if(t.insertRule(":host { display: block; }"),e=[this.globalStyles,t],s){const r=new CSSStyleSheet;r.replace(s),e.push(r)}return e}},{html:q,render:ee}=(()=>{const s=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,e=/<[a-z][^>]+$/i,t="attr",r=/^attr([^ ]+)/,u="insertNode",i=/^insertNode([^ ]+)/;let h=[],y=[];const m=a=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let d=JSON.stringify(a);const c=f=>n[f]||f;return d=(f=>f.replace(/[&<>\(\)]/g,c))(d),JSON.parse(d)},A=(a,n)=>{const d=a.options,c=Array.isArray(n)?n:[n];let w,f,o=d.length;for(;o--;){f=d[o];const b=f.getAttribute("value")??(f.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(f.selected=c.indexOf(b)>-1)&&(w=!0)}w||(a.selectedIndex=-1)},x=a=>{const n=document.createElement("template");return n.innerHTML=a,n.content},Y=(a,n,d)=>{const c=()=>{setTimeout(()=>{if(a.isConnected){const w=new CustomEvent("bindprops",{detail:{props:n},bubbles:!1});a.dispatchEvent(w)}})};a[d]=JSON.stringify(n),y.push(c)},v=(a,n)=>{const d=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,null);let c=d.nextNode();for(;c;){if(c.hasAttributes()){const w=Array.from(c.attributes).filter(f=>r.test(f.nodeName));for(const{nodeName:f,nodeValue:o}of w){const b=r.exec(f)[1];switch(!0){case/^on+/.test(o):{const g=o.slice(2).toLowerCase();c.removeEventListener(g,n[b]),c.addEventListener(g,n[b]);break}case/ref/.test(o):{const g=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:c,fn:n[b]});h.push(g);break}case/^data-+/.test(o):case/^aria-+/.test(o):{o==="data-input"?Y(c,n[b],Symbol("input")):c.setAttribute(o,m(n[b]));break}case/class/.test(o):{n[b]?c.classList.add(...n[b].split(" ")):c.setAttribute("class","");break}case/value/.test(o):{c.nodeName.toLowerCase()==="select"?A(c,n[b]):c.value=m(n[b]);break}case/disabled/.test(o):case/checked/.test(o):{n[b]?c.setAttribute(o,n[b]):c.removeAttribute(o);break}default:c.setAttribute(o,m(n[b]))}c.removeAttribute(f)}}c=d.nextNode()}},E=(a,n)=>{const d=document.createTreeWalker(a,NodeFilter.SHOW_COMMENT,null);let c=d.nextNode(),w;for(;c;){if(w=i.exec(c.data)){const f=Array.isArray(n[w[1]])?n[w[1]]:[n[w[1]]];c.replaceWith(...f),d.currentNode=a}c=d.nextNode()}},T=(a,n)=>{if(!a||!n||a.nodeType!==1||n.nodeType!==1)return;const d=a.attributes,c=n.attributes,w=n.getAttribute("data-preserve-attributes"),f=w&&w==="true";for(const{name:o,value:b}of d)(!c[o]||c[o]!==b)&&n.setAttribute(o,b);if(!f)for(const{name:o}of c)d[o]||n.removeAttribute(o);if(n.tagName.toLowerCase()==="input"&&(n.value=a.value),n.tagName.indexOf("-")>-1&&a.tagName.indexOf("-")>-1){const o=Object.getOwnPropertySymbols(a),b=Object.getOwnPropertySymbols(n),g=o.length?a[o[0]]:"",L=b.length?n[b[0]]:"";g&&L&&g!==L&&Y(n,JSON.parse(g),b[0])}},N=a=>a.nodeType===3?"text":a.nodeType===8?"comment":a.tagName.toLowerCase(),P=a=>a.childNodes&&a.childNodes.length>0?null:a.textContent,O=(a,n,d)=>{const c=n?Array.from(n.childNodes):[],w=a?Array.from(a.childNodes):[];let f=c.length-w.length;if(f>0)for(;f>0;f--)c[c.length-f].parentNode.removeChild(c[c.length-f]);w.forEach(function(o,b){const g=c[b];if(T(o,g),d&&g&&g.nodeType===1&&g.tagName.indexOf("-")>-1)return;if(!g){n&&n.appendChild(o);return}if(N(o)!==N(g)){g.replaceWith(o);return}const L=P(o);if(L&&L!==P(g)){g.textContent=L;return}if(g.childNodes.length>0&&o.childNodes.length<1){g.innerHTML="";return}if(g.childNodes.length<1&&o.childNodes.length>0){const V=document.createDocumentFragment();O(o,V,!1),g.appendChild(V);return}if(o.childNodes.length>0){O(o,g,!0);return}})};return{html:(a,...n)=>{let d="";const{length:c}=a;for(let f=1;f<c;f++){const o=n[f-1];let b=!1;if(d+=a[f-1],s.test(d)&&e.test(d)&&(d=d.replace(s,(g,L,V)=>`${t}${f-1}=${V||'"'}${L}${V?"":'"'}`),b=!0),!b)switch(!0){case Array.isArray(o):case o instanceof DocumentFragment:{d+=`<!--${u}${f-1}-->`;break}case(typeof o=="object"&&o!==null):{"html"in o&&(d+=o.html);break}default:d+=o||""}}d+=a[c-1];const w=x(d.trim());return v(w,n),E(w,n),w},render:(a,n)=>{a&&!a.children.length?(a.innerHTML="",a.appendChild(n)):O(n,a,!1),h.forEach(d=>{d()}),h=[],y.forEach(d=>{d()}),y=[]}}})();class J{constructor(e,t){_(this,"_shadowRoot");_(this,"_hostElement");_(this,"update");_(this,"emitEvent");this._hostElement=e,this._shadowRoot=t}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const pe={selector:"",root:!1,styles:"",deps:[],standalone:!1,encapsulation:"shadowDom"},te=(s,e)=>{const t=document.createElement("style");return t.innerHTML=s,e&&e.appendChild(t),t},be=(s,e)=>{var t,r,u,i,h,ie,m,oe,x;if(s={...pe,...s},s.styles=s.styles.toString(),s.root&&!j.isRootNodeSet)j.isRootNodeSet=!0,s.styles&&(j.globalStyles.replace(s.styles),j.globalStyleTag=te(s.styles,document.head));else if(s.root&&j.isRootNodeSet)throw Error("Cannot register duplicate root component in "+s.selector+" component");window.customElements.define(s.selector,(x=class extends HTMLElement{constructor(){super();M(this,h);M(this,m);M(this,t,void 0);M(this,r,void 0);M(this,u,void 0);_(this,"renderCount",0);M(this,i,new W);if(ae)H(this,r,this.attachShadow({mode:"open"})),S(this,r).adoptedStyleSheets=j.getComputedCss(s.styles,s.standalone);else{H(this,r,this);const v=s.styles.replaceAll(":host",s.selector);H(this,u,te(v,document.head))}K(this,h,ie).call(this),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this)}static get observedAttributes(){return e.observedAttributes||[]}update(){const v=S(this,t).render();typeof v=="string"?S(this,r).innerHTML=ue(v):ee(S(this,r),v)}setProps(v){var E,T;for(const[N,P]of Object.entries(v))e.observedProperties.find(O=>O===N)&&(S(this,t)[N]=P);(T=(E=S(this,t)).onPropertiesChanged)==null||T.call(E)}getInstance(){return S(this,t)}connectedCallback(){var v,E,T,N;S(this,i).add(B(this,"bindprops",P=>{const O=P.detail.props;O&&this.setProps(O)})),S(this,i).add(B(this,"refresh_component",()=>{var P,O;(O=(P=S(this,t)).mount)==null||O.call(P)})),(E=(v=S(this,t)).beforeMount)==null||E.call(v),this.update(),(N=(T=S(this,t)).mount)==null||N.call(T)}attributeChangedCallback(v,E,T){var N,P;(P=(N=S(this,t)).onAttributesChanged)==null||P.call(N,v,E,T)}disconnectedCallback(){var v,E,T;this.renderCount=1,(E=(v=S(this,t)).unmount)==null||E.call(v),(T=S(this,u))==null||T.remove(),S(this,i).unsubscribe()}},t=new WeakMap,r=new WeakMap,u=new WeakMap,i=new WeakMap,h=new WeakSet,ie=function(){const v=new J(this,S(this,r));v.update=()=>{this.update()},v.emitEvent=(E,T)=>{K(this,m,oe).call(this,E,T)},H(this,t,Z(de(this,e),s.deps,v))},m=new WeakSet,oe=function(v,E){const T=new CustomEvent(v,{detail:E});this.dispatchEvent(T)},x))},me={deps:[]},se=s=>e=>{if(s.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(s.selector)||be(s,e)},U=(s={})=>e=>{if(s={...me,...s},e.prototype.__metadata__={name:"SERVICE"},s.deps.some(r=>r.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const t=Z(e,s.deps);p.register(e,t)},ge=s=>{let e;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?e=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:e=s.value;break}case"select":{const t=s.type==="select-one",u=[...Array.from(s.options)].filter(i=>i.selected).map(i=>i.value??(i.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=t?u[0]:u;break}default:{e=s.value;break}}return e};class _e{constructor(e){_(this,"_initialValues");_(this,"_controls",Object.create(null));_(this,"_errors",new Map);this._initialValues=e;for(const[t,r]of Object.entries(e)){const u=[...Array.isArray(r)?r:[r]];this._controls[t]={value:u[0],validators:u.length>1?u[1]:[]}}this.changeHandler=this.changeHandler.bind(this),this.getControl=this.getControl.bind(this),this.reset=this.reset.bind(this)}get errors(){return this._checkValidity(),this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const e={};for(const[t,r]of Object.entries(this._controls))e[t]=r.value;return e}getControl(e){return this._controls[e]}changeHandler(e){return t=>{const r=ge(t.target);this.getControl(e).value=r,this._isTouched=!0}}reset(){for(const[e,t]of Object.entries(this._initialValues)){const r=[...Array.isArray(t)?t:[t]];this._controls[e].value=JSON.parse(JSON.stringify(r))[0]}this._errors.clear(),this._isTouched=!1}_checkValidity(){this._errors.clear(),this._isTouched=!0;for(const e in this._controls){const t=this._controls[e].value,r=this._controls[e].validators;this._controls[e].errors=null;for(const u of r){const i=u(t);i!==null&&(this._errors.has(e)?(this._errors.set(e,{...this._errors.get(e),...i}),this._controls[e].errors={...this._controls[e].errors,...i}):(this._errors.set(e,i),this._controls[e].errors=i))}}}}class ye{static required(e){return e.length?null:{required:!0}}static min(e){return t=>t.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return t=>t.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return t=>new RegExp(e).test(t)?null:{pattern:!0}}}const I=class{static checkParams(e,t){let r=0;const u={},i=t.paramCount;for(let h=0;h<e.length;h++){const y=t.params[h];y.indexOf(":")>=0&&(u[y.split(":")[1]]=e[h].split("?")[0],r+=1)}return r===i?u:{}}static getParamCount(e){let t=0;return e.forEach(r=>{r.indexOf(":")>=0&&(t+=1)}),t}static formatRoute(e){const t={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:e.preload,canActivate:()=>!0};if(t.params=e.path.split("/").filter(r=>r.length>0),t.url=e.path,t.template="",t.redirectTo=e.redirectTo,e.template){if(!e.templatePath)throw Error("templatePath is required in route if template is mentioned.");t.template=e.template,t.templatePath=e.templatePath}e.canActivate&&(t.canActivate=e.canActivate),t.paramCount=I.getParamCount(t.params),I.routeList.push(t)}static preloadRoutes(){for(const e of I.routeList)e.templatePath&&e.templatePath()}static preloadSelectedRoutes(){const e=I.routeList.filter(t=>t.preload===!0);for(const t of e)t.templatePath&&t.templatePath()}};let C=I;_(C,"routeList",[]),_(C,"isHistoryBasedRouting",!0);function ve(s,e){return s?new RegExp(s.replace(/:[^\s/]+/g,"(.+)")).test(e):!1}class z{constructor(){_(this,"_currentRoute",{path:"",routeParams:new Map,queryParams:new Map,state:{}});_(this,"_template",new X(""));_(this,"_navigationEndEvent",new F);_(this,"_routeStateMap",new Map)}listenRouteChanges(){const e=C.isHistoryBasedRouting?"popstate":"hashchange";return C.isHistoryBasedRouting&&(window.history.replaceState({},null,""),function(t,r){var u=t.pushState;t.pushState=function(...i){u.apply(t,i),r()}}(window.history,this._registerOnHashChange.bind(this))),B(window,e,()=>{this._registerOnHashChange()})}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute}navigateTo(e="/",t){let r=C.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");r=r||"/",this._routeStateMap.clear(),this._routeStateMap.set(e,t),r===e?this._navigateTo(e,t):C.isHistoryBasedRouting?window.history.pushState(t,"",e):window.location.hash="#"+e}onNavigationEnd(){return this._navigationEndEvent.asObservable()}_registerOnHashChange(){const e=C.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,""),t=this._routeStateMap.get(e);this._navigateTo(e,t)}_navigateTo(e,t){const r=e.split("/").filter(h=>h.length>0),u=C.routeList.filter(h=>{if(h.params.length===r.length&&ve(h.url,e))return h;if(h.url===e)return h}),i=u.length>0?u[0]:null;i&&(this._currentRoute.path=e,this._currentRoute.state={...t||{}},$(i.canActivate()).subscribe(h=>{if(!h)return;const y=C.checkParams(r,i);if(Object.keys(y).length>0||e){this._currentRoute.routeParams=new Map(Object.entries(y));let m=[];C.isHistoryBasedRouting?m=new URLSearchParams(window.location.search).entries():m=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[],this._currentRoute.queryParams=new Map(m);const A=x=>{x.isRegistered=!0,this._template.next(x.template),this._navigationEndEvent.next()};i.isRegistered?A(i):i.templatePath?$(i.templatePath()).subscribe(()=>{A(i)}):i.redirectTo&&this.navigateTo(i.redirectTo,t)}else this.navigateTo(i.redirectTo,t)}))}}U()(z);const we=()=>{class s{constructor(t,r){_(this,"_template","");_(this,"_subscriptions",new W)}beforeMount(){this._subscriptions.add(this.internalRouterSrvc.getTemplate().subscribe(t=>{this._template!==t?this._template=t:this.refreshRouterOutletComponent()})),this._subscriptions.add(this.internalRouterSrvc.listenRouteChanges())}mount(){const t=C.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(t||"/")}unmount(){this._subscriptions.unsubscribe()}refreshRouterOutletComponent(){if(this.renderer.shadowRoot.children.length){const t=new CustomEvent("refresh_component",{detail:{},bubbles:!1,cancelable:!1,composed:!1});this.renderer.shadowRoot.children[0].dispatchEvent(t)}}render(){if(this._template){const t=[`${this._template}`];return t.raw=[`${this._template}`],q(t)}else return q``}}se({selector:"router-outlet",deps:[z,J]})(s)};class re{constructor(e){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(e,t){this.internalRouter.navigateTo(e,t)}onNavigationEnd(){return this.internalRouter.onNavigationEnd()}registerRoutes(e,t=!1,r=!1){if(r&&(C.isHistoryBasedRouting=!r),Array.isArray(e)){for(const u of e)C.formatRoute(u);t?C.preloadRoutes():C.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}U({deps:[z]})(re),l.BehaviourSubjectObs=X,l.Component=se,l.FormBuilder=_e,l.Injectable=U,l.Renderer=J,l.Router=re,l.SubjectObs=F,l.Subscriptions=W,l.Validators=ye,l.fromEvent=B,l.html=q,l.promisify=fe,l.registerRouterComponent=we,l.render=ee,l.wrapIntoObservable=$,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
