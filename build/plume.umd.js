var Pe=Object.defineProperty;var ke=(l,b,C)=>b in l?Pe(l,b,{enumerable:!0,configurable:!0,writable:!0,value:C}):l[b]=C;var m=(l,b,C)=>(ke(l,typeof b!="symbol"?b+"":b,C),C),Z=(l,b,C)=>{if(!b.has(l))throw TypeError("Cannot "+C)};var v=(l,b,C)=>(Z(l,b,"read from private field"),C?C.call(l):b.get(l)),M=(l,b,C)=>{if(b.has(l))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(l):b.set(l,C)},H=(l,b,C,D)=>(Z(l,b,"write to private field"),D?D.call(l,C):b.set(l,C),C);var ee=(l,b,C)=>(Z(l,b,"access private method"),C);(function(l,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(l=typeof globalThis<"u"?globalThis:l||self,b(l.PlumeJS={}))})(this,function(l){var x,ce;"use strict";const b=s=>!!s&&typeof s.subscribe=="function",C=s=>!!s&&typeof s.then=="function",D=s=>{const e=s.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return e.length===3?e[1].split(",").map(t=>t.trim()):[]},he=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),de=s=>({subscribe:e=>{e(s)}}),fe=s=>({subscribe:e=>{Promise.resolve(s).then(t=>{e(t)})}}),$=()=>Math.random().toString(36).substring(2);class q{constructor(){m(this,"_callbackCollection",{})}unsubscribe(e){delete this._callbackCollection[e]}asObservable(){return{subscribe:e=>this.subscribe(e)}}subscribe(e){const t=$();return this._callbackCollection[t]=e,()=>this.unsubscribe(t)}next(e){for(const t in this._callbackCollection)this._callbackCollection[t](e)}}class J extends q{constructor(t){super();m(this,"_initialValue");this._initialValue=t}subscribe(t){const r=super.subscribe(t);return super.next(this._initialValue),r}next(t){this._initialValue=t,super.next(t)}}class z{constructor(){m(this,"_subcribers",[])}add(e){this._subcribers.push(e)}unsubscribe(){for(const e of this._subcribers)e();this._subcribers=[]}}const Q=s=>b(s)?s:C(s)?fe(Promise.resolve(s)):de(s),W=(s,e,t,r=!1)=>(s.addEventListener(e,t,r),()=>{s.removeEventListener(e,t,r)}),pe=s=>{const e=()=>new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),t=p=>{const w=p.querySelectorAll("script");for(const A of w)A.remove()},r=(p,w)=>{if(w=w.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(p)&&(w.includes("javascript:")||w.includes("data:"))||p.startsWith("on"))return!0},o=p=>{const w=p.attributes;for(const{name:A,value:P}of w)r(A,P)&&p.removeAttribute(A)},a=p=>{const w=p.children;for(const A of w)o(A),a(A)},h=e();return t(h),a(h),h.innerHTML},be=(s,e)=>{const t=D(e),r=()=>({get(o,a){const h=Object.prototype.toString.call(o[a]);return["[object Object]","[object Array]"].indexOf(h)>-1&&!("__metadata__"in o[a])?new Proxy(o[a],r()):o[a]},set(o,a,h){return o[a]=h,s(),!0}});return class extends e{constructor(...o){return super(...o),o.forEach((a,h)=>{t[h]&&t[h]!=="undefined"&&(this[t[h]]=a)}),new Proxy(this,r())}}},ge=()=>{let s;return[new Promise(t=>{s=t}),s]},me=s=>typeof s=="function",U=Object.create(null);let j=null;function ye(s,e){const t=j;let r;j=$(),U[j]=s;try{e()}finally{r=j,j=t}return r}function te(s){const e=U[j];let t=s;function r(){return t}return r.set=function(o){me(o)?t=o(t):t=o,e()},r}function _e(s,e){const t=ye(s,e);return function(){delete U[t]}}const se=new(ce=class{constructor(){M(this,x,void 0);H(this,x,new WeakMap)}register(s,e){if(!v(this,x).get(s))v(this,x).set(s,e);else throw console.error(s),"service already exists"}getService(s){const e=v(this,x).get(s);if(e)return e;throw console.error(s),"service is not a registered service."}clear(){H(this,x,new WeakMap)}},x=new WeakMap,ce),re=(s,e,t)=>{if(e.length>0){const r=[];for(const h of e)h.prototype.__metadata__.name!=="RENDERER"?r.push(se.getService(h)):r.push(t);const o=D(s),a=new s(...r);return e.forEach((h,p)=>{a[o[p]]=r[p]}),a}else return new s},V=new class{constructor(){m(this,"globalStyles");m(this,"globalStyleTag");m(this,"style_registry");m(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let e=[];const t=new CSSStyleSheet;if(t.insertRule(":host { display: block; }"),e=[this.globalStyles,t],s){const r=new CSSStyleSheet;r.replace(s),e.push(r)}return e}},{html:Y,render:ne}=(()=>{const s=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,e=/<[a-z][^>]+$/i,t="attr",r=/^attr([^ ]+)/,o="insertNode",a=/^insertNode([^ ]+)/;let h=[],p=[];const w=c=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let d=JSON.stringify(c);const u=f=>n[f]||f;return d=(f=>f.replace(/[&<>\(\)]/g,u))(d),JSON.parse(d)},A=(c,n)=>{const d=c.options,u=Array.isArray(n)?n:[n];let S,f,i=d.length;for(;i--;){f=d[i];const g=f.getAttribute("value")??(f.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(f.selected=u.indexOf(g)>-1)&&(S=!0)}S||(c.selectedIndex=-1)},P=c=>{const n=document.createElement("template");return n.innerHTML=c,n.content},L=(c,n,d)=>{const u=()=>{setTimeout(()=>{if(c.isConnected){const S=new CustomEvent("bindprops",{detail:{props:n},bubbles:!1});c.dispatchEvent(S)}})};c[d]=JSON.stringify(n),p.push(u)},y=(c,n)=>{const d=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null);let u=d.nextNode();for(;u;){if(u.hasAttributes()){const S=Array.from(u.attributes).filter(f=>r.test(f.nodeName));for(const{nodeName:f,nodeValue:i}of S){const g=r.exec(f)[1];switch(!0){case/^on+/.test(i):{const _=i.slice(2).toLowerCase();u.removeEventListener(_,n[g]),u.addEventListener(_,n[g]);break}case/ref/.test(i):{const _=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:u,fn:n[g]});h.push(_);break}case/^data-+/.test(i):case/^aria-+/.test(i):{i==="data-input"?L(u,n[g],Symbol("input")):u.setAttribute(i,w(n[g]));break}case/class/.test(i):{n[g]?u.classList.add(...n[g].split(" ")):u.setAttribute("class","");break}case/value/.test(i):{u.nodeName.toLowerCase()==="select"?A(u,n[g]):u.value=w(n[g]);break}case/disabled/.test(i):case/checked/.test(i):{n[g]?u.setAttribute(i,n[g]):u.removeAttribute(i);break}default:u.setAttribute(i,w(n[g]))}u.removeAttribute(f)}}u=d.nextNode()}},R=(c,n)=>{const d=document.createTreeWalker(c,NodeFilter.SHOW_COMMENT,null);let u=d.nextNode(),S;for(;u;){if(S=a.exec(u.data)){const f=Array.isArray(n[S[1]])?n[S[1]]:[n[S[1]]];u.replaceWith(...f),d.currentNode=c}u=d.nextNode()}},T=(c,n)=>{if(!c||!n||c.nodeType!==1||n.nodeType!==1)return;const d=c.attributes,u=n.attributes,S=n.getAttribute("data-preserve-attributes"),f=S&&S==="true";for(const{name:i,value:g}of d)(!u[i]||u[i]!==g)&&n.setAttribute(i,g);if(!f)for(const{name:i}of u)d[i]||n.removeAttribute(i);if(n.tagName.toLowerCase()==="input"&&(n.value=c.value),n.tagName.indexOf("-")>-1&&c.tagName.indexOf("-")>-1){const i=Object.getOwnPropertySymbols(c).find(k=>k.description==="input"),g=Object.getOwnPropertySymbols(n).find(k=>k.description==="input"),_=i?c[i]:"",O=g?n[g]:"";_&&O&&_!==O&&L(n,JSON.parse(_),g)}},N=c=>c.nodeType===3?"text":c.nodeType===8?"comment":c.tagName.toLowerCase(),I=c=>c.childNodes&&c.childNodes.length>0?null:c.textContent,B=(c,n,d)=>{const u=n?Array.from(n.childNodes):[],S=c?Array.from(c.childNodes):[];let f=u.length-S.length;if(f>0)for(;f>0;f--)u[u.length-f].parentNode.removeChild(u[u.length-f]);S.forEach(function(i,g){const _=u[g];if(T(i,_),d&&_&&_.nodeType===1&&_.tagName.indexOf("-")>-1)return;if(!_){n&&n.appendChild(i);return}if(N(i)!==N(_)){_.replaceWith(i);return}const O=I(i);if(O&&O!==I(_)){_.textContent=O;return}if(_.childNodes.length>0&&i.childNodes.length<1){_.innerHTML="";return}if(_.childNodes.length<1&&i.childNodes.length>0){const k=document.createDocumentFragment();B(i,k,!1),_.appendChild(k);return}if(i.childNodes.length>0){B(i,_,!0);return}})};return{html:(c,...n)=>{let d="";const{length:u}=c;for(let f=1;f<u;f++){const i=n[f-1];let g=!1;if(d+=c[f-1],s.test(d)&&e.test(d)&&(d=d.replace(s,(_,O,k)=>`${t}${f-1}=${k||'"'}${O}${k?"":'"'}`),g=!0),!g)switch(!0){case Array.isArray(i):case i instanceof DocumentFragment:{d+=`<!--${o}${f-1}-->`;break}case(typeof i=="object"&&i!==null):{"html"in i&&(d+=i.html);break}default:d+=i||""}}d+=c[u-1];const S=P(d.trim());return y(S,n),R(S,n),S},render:(c,n)=>{c&&!c.children.length?(c.innerHTML="",c.appendChild(n)):B(n,c,!1),h.forEach(d=>{d()}),h=[],p.forEach(d=>{d()}),p=[]}}})();class G{constructor(e,t){m(this,"_shadowRoot");m(this,"_hostElement");m(this,"update");m(this,"emitEvent");this._hostElement=e,this._shadowRoot=t}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const we={selector:"",root:!1,styles:"",deps:[],standalone:!1,encapsulation:"shadowDom"},ie=(s,e)=>{const t=document.createElement("style");return t.innerHTML=s,e&&e.appendChild(t),t},ve=async(s,e)=>{var t,r,o,a,h,le,w,ue,P;if(s={...we,...s},C(s.styles)){const L=await s.styles;s.styles=L.default.toString()}if(s.styles=s.styles.toString(),s.root&&!V.isRootNodeSet)V.isRootNodeSet=!0,s.styles&&(V.globalStyles.replace(s.styles),V.globalStyleTag=ie(s.styles,document.head));else if(s.root&&V.isRootNodeSet)throw Error("Cannot register duplicate root component in "+s.selector+" component");window.customElements.define(s.selector,(P=class extends HTMLElement{constructor(){super();M(this,h);M(this,w);M(this,t,void 0);M(this,r,void 0);M(this,o,void 0);M(this,a,new z);m(this,"renderCount",0);if(he)H(this,r,this.attachShadow({mode:"open"})),v(this,r).adoptedStyleSheets=V.getComputedCss(s.styles,s.standalone);else{H(this,r,this);const y=$();this.setAttribute("data-did",y);const R=s.styles.replaceAll(":host",`${s.selector}[data-did='${y}']`);!s.root&&R&&H(this,o,ie(R,document.head))}this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this),this.setRenderIntoQueue=this.setRenderIntoQueue.bind(this),ee(this,h,le).call(this)}static get observedAttributes(){return e.observedAttributes||[]}update(){const y=v(this,t).render();typeof y=="string"?v(this,r).innerHTML=pe(y):ne(v(this,r),y)}setProps(y){var R,T;for(const[N,I]of Object.entries(y))e.observedProperties.find(B=>B===N)&&(v(this,t)[N]=I);(T=(R=v(this,t)).onPropertiesChanged)==null||T.call(R)}getInstance(){return v(this,t)}setRenderIntoQueue(){++this.renderCount,this.renderCount===1&&queueMicrotask(()=>{this.update(),this.renderCount=0})}connectedCallback(){var y,R;v(this,a).add(W(this,"bindprops",T=>{const N=T.detail.props;N&&this.setProps(N)})),v(this,a).add(W(this,"refresh_component",()=>{this.update()})),v(this,t).beforeMount&&v(this,a).add(_e(this.setRenderIntoQueue,v(this,t).beforeMount.bind(v(this,t)))),this.update(),(R=(y=v(this,t)).mount)==null||R.call(y)}attributeChangedCallback(y,R,T){var N,I;(I=(N=v(this,t)).onAttributesChanged)==null||I.call(N,y,R,T)}disconnectedCallback(){var y,R,T;this.renderCount=1,(R=(y=v(this,t)).unmount)==null||R.call(y),(T=v(this,o))==null||T.remove(),v(this,a).unsubscribe()}},t=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakSet,le=function(){const y=new G(this,v(this,r));y.update=()=>{this.update()},y.emitEvent=(R,T)=>{ee(this,w,ue).call(this,R,T)},H(this,t,re(be(this.setRenderIntoQueue,e),s.deps,y))},w=new WeakSet,ue=function(y,R){const T=new CustomEvent(y,{detail:R});this.dispatchEvent(T)},P))},Se={deps:[]},oe=s=>e=>{if(s.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(s.selector)||ve(s,e)},K=(s={})=>e=>{if(s={...Se,...s},e.prototype.__metadata__={name:"SERVICE"},s.deps.some(r=>r.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const t=re(e,s.deps);se.register(e,t)};function Ce(s,e){return s.nodeName&&s.nodeName.toLowerCase()===e.toLowerCase()}const Re=s=>{let e;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?e=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:e=s.value;break}case"select":{const t=s.type==="select-one",o=[...Array.from(s.options).filter(a=>!a.disabled&&(!a.parentNode.disabled||!Ce(a.parentNode,"optgroup")))].filter(a=>a.selected).map(a=>a.value??(a.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=t?o[0]:o;break}default:{e=s.value;break}}return e};class Ee{constructor(e){m(this,"_initialValues");m(this,"_controls",new Map);m(this,"_errors",new Map);m(this,"_errorCount");this._errorCount=te(0),this._initialValues=e;for(const[t,r]of Object.entries(e)){const o=[...Array.isArray(r)?r:[r]];this._controls.set(t,{value:o[0],validators:o.length>1?o[1]:[]})}}get hasErrors(){return!!this._errorCount()}get errors(){return this._checkValidity(),this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const e={};for(const[t,r]of this._controls)e[t]=r.value;return e}getControl(e){return this._controls.get(e)}changeHandler(e){return t=>{const r=Re(t.target);this.getControl(e).value=r,this._errorCount.set(0)}}reset(){for(const[e,t]of Object.entries(this._initialValues)){const r=[...Array.isArray(t)?t:[t]];this._controls.get(e).value=JSON.parse(JSON.stringify(r))[0]}this._errors.clear(),this._errorCount.set(0)}_checkValidity(){this._errors.clear();for(const[e,{value:t,validators:r}]of this._controls)for(const o of r){const a=o(t);a!==null&&(this._errors.has(e)?this._errors.set(e,{...this._errors.get(e),...a}):this._errors.set(e,a))}this._errorCount.set(this._errors.size)}}class Te{static required(e){return e.length?null:{required:!0}}static min(e){return t=>t.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return t=>t.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return t=>new RegExp(e).test(t)?null:{pattern:!0}}}const F=class{static checkParams(e,t){let r=0;const o={},a=t.paramCount;for(let h=0;h<e.length;h++){const p=t.params[h];p.indexOf(":")>=0&&(o[p.split(":")[1]]=e[h].split("?")[0],r+=1)}return r===a?o:{}}static getParamCount(e){let t=0;return e.forEach(r=>{r.indexOf(":")>=0&&(t+=1)}),t}static formatRoute(e){const t={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:e.preload,canActivate:()=>!0};if(t.params=e.path.split("/").filter(r=>r.length>0),t.url=e.path,t.template="",t.redirectTo=e.redirectTo,e.template){if(!e.templatePath)throw Error("templatePath is required in route if template is mentioned.");t.template=e.template,t.templatePath=e.templatePath}e.canActivate&&(t.canActivate=e.canActivate),t.paramCount=F.getParamCount(t.params),F.routeList.push(t)}static preloadRoutes(){for(const e of F.routeList)e.templatePath&&e.templatePath()}static preloadSelectedRoutes(){const e=F.routeList.filter(t=>t.preload===!0);for(const t of e)t.templatePath&&t.templatePath()}};let E=F;m(E,"routeList",[]),m(E,"isHistoryBasedRouting",!0);function Ae(s,e){return s?new RegExp(s.replace(/:[^\s/]+/g,"(.+)")).test(e):!1}class X{constructor(){m(this,"_currentRoute",new J({path:"",routeParams:new Map,queryParams:new Map,state:{}}));m(this,"_template",new J(""));m(this,"_navigationEndEvent",new q);m(this,"_routeStateMap",new Map)}listenRouteChanges(){const e=E.isHistoryBasedRouting?"popstate":"hashchange";return E.isHistoryBasedRouting&&(window.history.replaceState({},null,""),function(t,r){var o=t.pushState;t.pushState=function(...a){o.apply(t,a),r()}}(window.history,this._registerOnHashChange.bind(this))),W(window,e,()=>{this._registerOnHashChange()})}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute.asObservable()}navigateTo(e="/",t){let r=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");r=r||"/",this._routeStateMap.clear(),this._routeStateMap.set(e,t),r===e?this._navigateTo(e,t):E.isHistoryBasedRouting?window.history.pushState(t,"",e):window.location.hash="#"+e}onNavigationEnd(){return this._navigationEndEvent.asObservable()}_registerOnHashChange(){const e=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,""),t=this._routeStateMap.get(e);this._navigateTo(e,t)}_navigateTo(e,t){const r={},o=e.split("/").filter(p=>p.length>0),a=E.routeList.filter(p=>{if(p.params.length===o.length&&Ae(p.url,e))return p;if(p.url===e)return p}),h=a.length>0?a[0]:null;h&&(r.path=e,r.state={...t||{}},Q(h.canActivate()).subscribe(p=>{if(!p)return;const w=E.checkParams(o,h);if(Object.keys(w).length>0||e){r.routeParams=new Map(Object.entries(w));let A=[];E.isHistoryBasedRouting?A=new URLSearchParams(window.location.search).entries():A=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[],r.queryParams=new Map(A);const P=L=>{L.isRegistered=!0,this._currentRoute.next(r),this._template.next(L.template),this._navigationEndEvent.next()};h.isRegistered?P(h):h.templatePath?Q(h.templatePath()).subscribe(()=>{P(h)}):h.redirectTo&&this.navigateTo(h.redirectTo,t)}else this.navigateTo(h.redirectTo,t)}))}}K()(X);const Ne=()=>{class s{constructor(t,r){m(this,"_template","");m(this,"_subscriptions",new z)}beforeMount(){this._subscriptions.add(this.internalRouterSrvc.getTemplate().subscribe(t=>{this._template!==t&&(this._template=t)})),this._subscriptions.add(this.internalRouterSrvc.listenRouteChanges())}mount(){const t=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(t||"/")}unmount(){this._subscriptions.unsubscribe()}render(){if(this._template){const t=[`${this._template}`];return t.raw=[`${this._template}`],Y(t)}else return Y``}}oe({selector:"router-outlet",deps:[X,G]})(s)};class ae{constructor(e){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(e,t){this.internalRouter.navigateTo(e,t)}onNavigationEnd(){return this.internalRouter.onNavigationEnd()}registerRoutes(e,t=!1,r=!1){if(r&&(E.isHistoryBasedRouting=!r),Array.isArray(e)){for(const o of e)E.formatRoute(o);t?E.preloadRoutes():E.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}K({deps:[X]})(ae),l.BehaviourSubjectObs=J,l.Component=oe,l.FormBuilder=Ee,l.Injectable=K,l.Renderer=G,l.Router=ae,l.SubjectObs=q,l.Subscriptions=z,l.Validators=Te,l.fromEvent=W,l.html=Y,l.promisify=ge,l.registerRouterComponent=Ne,l.render=ne,l.signal=te,l.wrapIntoObservable=Q,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
