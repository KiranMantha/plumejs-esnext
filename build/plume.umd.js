var Ce=Object.defineProperty;var Re=(i,m,S)=>m in i?Ce(i,m,{enumerable:!0,configurable:!0,writable:!0,value:S}):i[m]=S;var w=(i,m,S)=>(Re(i,typeof m!="symbol"?m+"":m,S),S),U=(i,m,S)=>{if(!m.has(i))throw TypeError("Cannot "+S)};var y=(i,m,S)=>(U(i,m,"read from private field"),S?S.call(i):m.get(i)),M=(i,m,S)=>{if(m.has(i))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(i):m.set(i,S)},F=(i,m,S,O)=>(U(i,m,"write to private field"),O?O.call(i,S):m.set(i,S),S);var I=(i,m,S)=>(U(i,m,"access private method"),S);(function(i,m){typeof exports=="object"&&typeof module<"u"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(i=typeof globalThis<"u"?globalThis:i||self,m(i.PlumeJS={}))})(this,function(i){var x,te;"use strict";const m=new(te=class{constructor(){M(this,x,void 0);F(this,x,new WeakMap)}register(r,e){if(!y(this,x).get(r))y(this,x).set(r,e);else throw console.error(r),"service already exists"}getService(r){const e=y(this,x).get(r);if(e)return e;throw console.error(r),"service is not a registered service."}clear(){F(this,x,new WeakMap)}},x=new WeakMap,te),S=r=>typeof r=="function",O=r=>{const e=r.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return e.length===3?e[1].split(",").map(t=>t.trim()):[]},D=(()=>{try{return new CSSStyleSheet,!1}catch{return!0}})(),B=(r,e,t,s=!1)=>(r.addEventListener(e,t,s),()=>{r.removeEventListener(e,t,s)}),oe=r=>{const e=()=>new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),t=f=>{const v=f.querySelectorAll("script");for(const R of v)R.remove()},s=(f,v)=>{if(v=v.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(f)&&(v.includes("javascript:")||v.includes("data:"))||f.startsWith("on"))return!0},a=f=>{const v=f.attributes;for(const{name:R,value:z}of v)s(R,z)&&f.removeAttribute(R)},n=f=>{const v=f.children;for(const R of v)a(R),n(R)},c=e();return t(c),n(c),c.innerHTML},ie=function(r){r.renderCount===1&&queueMicrotask(()=>{r.update(),r.renderCount=0})},ae=(r,e)=>{const t=O(e),s=()=>({get(a,n){const c=Object.prototype.toString.call(a[n]);return["[object Object]","[object Array]"].indexOf(c)>-1&&!("__metadata__"in a[n])?new Proxy(a[n],s()):a[n]},set(a,n,c){return a[n]=c,++r.renderCount,ie(r),!0}});return class extends e{constructor(...a){return super(...a),a.forEach((n,c)=>{this[t[c]]=n}),new Proxy(this,s())}}},ce=()=>{let r;return[new Promise(t=>{r=t}),r]},Y=(r,e,t)=>{if(e.length>0){const s=[];for(const c of e)c.prototype.__metadata__.name!=="RENDERER"?s.push(m.getService(c)):s.push(t);const a=O(r),n=new r(...s);return e.forEach((c,f)=>{n[a[f]]=s[f]}),n}else return new r},N=new class{constructor(){w(this,"globalStyles");w(this,"globalStyleTag");w(this,"style_registry");w(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(r=""){let e=[];const t=new CSSStyleSheet;if(t.insertRule(":host { display: block; }"),e=[this.globalStyles,t],r){const s=new CSSStyleSheet;s.replace(r),e.push(s)}return e}},{html:W,render:G}=(()=>{const r=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,e=/<[a-z][^>]+$/i,t="attr",s=/^attr([^ ]+)/,a="insertNode",n=/^insertNode([^ ]+)/;let c=[];const f=l=>{const o={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let d=JSON.stringify(l);const u=h=>o[h]||h;return d=(h=>h.replace(/[&<>\(\)]/g,u))(d),JSON.parse(d)},v=(l,o)=>{const d=l.options,u=Array.isArray(o)?o:[o];let g,h,b=d.length;for(;b--;){h=d[b];const p=h.getAttribute("value")??(h.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(h.selected=u.indexOf(p)>-1)&&(g=!0)}g||(l.selectedIndex=-1)},R=l=>{const o=document.createElement("template");return o.innerHTML=l,o.content},z=(l,o)=>{const d=document.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,null);let u=d.nextNode();for(;u;){if(u.hasAttributes()){const g=Array.from(u.attributes).filter(h=>s.test(h.nodeName));for(const{nodeName:h,nodeValue:b}of g){const p=s.exec(h)[1];switch(!0){case/^on+/.test(b):{const T=b.slice(2).toLowerCase();u.removeEventListener(T,o[p]),T!=="bindprops"?u.addEventListener(T,o[p]):u.addEventListener(T,L=>{L.detail.setProps(o[p]())});break}case/ref/.test(b):{const T=(L=>{const j=L;return()=>{j.isConnected&&o[p](j)}})(u);c.push(T);break}case/^data-+/.test(b):case/^aria-+/.test(b):{u.setAttribute(b,f(o[p]));break}case/class/.test(b):{o[p]?u.classList.add(...o[p].split(" ")):u.setAttribute("class","");break}case/value/.test(b):{u.nodeName.toLowerCase()==="select"?v(u,o[p]):u.value=f(o[p]);break}case/disabled/.test(b):case/checked/.test(b):{o[p]?u.setAttribute(b,o[p]):u.removeAttribute(b);break}default:u.setAttribute(b,f(o[p]))}u.removeAttribute(h)}}u=d.nextNode()}},V=(l,o)=>{const d=document.createTreeWalker(l,NodeFilter.SHOW_COMMENT,null);let u=d.nextNode(),g;for(;u;){if(g=n.exec(u.data)){const h=Array.isArray(o[g[1]])?o[g[1]]:[o[g[1]]];u.replaceWith(...h),d.currentNode=l}u=d.nextNode()}},re=(l,o)=>{if(!l||!o||l.nodeType!==1||o.nodeType!==1)return;const d=l.attributes,u=o.attributes;for(const{name:g,value:h}of d)(!u[g]||u[g]!==h)&&o.setAttribute(g,h);for(const{name:g}of u)d[g]||o.removeAttribute(g)},_=l=>l.nodeType===3?"text":l.nodeType===8?"comment":l.tagName.toLowerCase(),C=l=>l.childNodes&&l.childNodes.length>0?null:l.textContent,E=(l,o)=>{const d=o?Array.from(o.childNodes):[],u=l?Array.from(l.childNodes):[];let g=d.length-u.length;if(g>0)for(;g>0;g--)d[d.length-g].parentNode.removeChild(d[d.length-g]);u.forEach(function(h,b){const p=d[b];if(re(h,p),!p){o&&o.appendChild(h);return}if(_(h)!==_(p)){p.replaceWith(h);return}const T=C(h);if(T&&T!==C(p)){p.textContent=T;return}if(p.childNodes.length>0&&h.childNodes.length<1){p.innerHTML="";return}if(p.childNodes.length<1&&h.childNodes.length>0){const L=document.createDocumentFragment();E(h,L),p.appendChild(L);return}if(h.childNodes.length>0){E(h,p);return}})};return{html:(l,...o)=>{let d="";const{length:u}=l;for(let h=1;h<u;h++){const b=o[h-1];let p=!1;if(d+=l[h-1],r.test(d)&&e.test(d)&&(d=d.replace(r,(T,L,j)=>`${t}${h-1}=${j||'"'}${L}${j?"":'"'}`),p=!0),!p)switch(!0){case Array.isArray(b):case b instanceof DocumentFragment:{d+=`<!--${a}${h-1}-->`;break}case(typeof b=="object"&&b!==null):{"html"in b&&(d+=b.html);break}default:d+=b}}d+=l[u-1];const g=R(d.trim());return z(g,o),V(g,o),g},render:(l,o)=>{l&&!l.children.length?(l.innerHTML="",l.appendChild(o)):E(o,l),c.forEach(d=>{d()}),c=[]}}})();class K{constructor(e,t){w(this,"_shadowRoot");w(this,"_hostElement");w(this,"update");w(this,"emitEvent");this._hostElement=e,this._shadowRoot=t}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const le={selector:"",root:!1,styles:"",deps:[],standalone:!1},Q=(r,e)=>{const t=document.createElement("style");return t.innerHTML=r,e&&e.appendChild(t),t},ue=(r,e)=>{var t,s,a,n,se,f,ne,R,J,V;if(r={...le,...r},r.styles=r.styles.toString(),r.root&&!N.isRootNodeSet)N.isRootNodeSet=!0,r.styles&&(N.globalStyles.replace(r.styles),N.globalStyleTag=Q(r.styles,document.head));else if(r.root&&N.isRootNodeSet)throw Error("Cannot register duplicate root component in "+r.selector+" component");window.customElements.define(r.selector,(V=class extends HTMLElement{constructor(){super();M(this,n);M(this,f);M(this,R);M(this,t,void 0);M(this,s,void 0);M(this,a,void 0);w(this,"renderCount",0);F(this,s,this.attachShadow({mode:"open"})),D||(y(this,s).adoptedStyleSheets=N.getComputedCss(r.styles,r.standalone)),I(this,n,se).call(this),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this)}static get observedAttributes(){return e.observedAttributes||[]}update(){const _=y(this,t).render();typeof _=="string"?y(this,s).innerHTML=oe(_):G(y(this,s),_),D&&(r.styles&&y(this,s).insertBefore(y(this,a),y(this,s).childNodes[0]),N.globalStyleTag&&!r.standalone&&y(this,s).insertBefore(document.importNode(N.globalStyleTag,!0),y(this,s).childNodes[0]))}setProps(_){var C,E;for(const[A,k]of Object.entries(_))e.observedProperties.find(l=>l===A)&&(y(this,t)[A]=k);(E=(C=y(this,t)).onPropertiesChanged)==null||E.call(C)}getInstance(){return y(this,t)}connectedCallback(){var _,C,E,A;I(this,f,ne).call(this),(C=(_=y(this,t)).beforeMount)==null||C.call(_),this.update(),(A=(E=y(this,t)).mount)==null||A.call(E),I(this,R,J).call(this,"bindprops",{setProps:k=>{this.setProps(k)}},!1)}attributeChangedCallback(_,C,E){var A,k;(k=(A=y(this,t)).onAttributesChanged)==null||k.call(A,_,C,E)}disconnectedCallback(){var _,C;this.renderCount=1,(C=(_=y(this,t)).unmount)==null||C.call(_)}},t=new WeakMap,s=new WeakMap,a=new WeakMap,n=new WeakSet,se=function(){const _=new K(this,y(this,s));_.update=()=>{this.update()},_.emitEvent=(C,E)=>{I(this,R,J).call(this,C,E)},F(this,t,Y(ae(this,e),r.deps,_))},f=new WeakSet,ne=function(){D&&r.styles&&F(this,a,Q(r.styles))},R=new WeakSet,J=function(_,C){const E=new CustomEvent(_,{detail:C});this.dispatchEvent(E)},V))},he={deps:[]},X=r=>e=>{if(r.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(r.selector)||ue(r,e)},$=(r={})=>e=>{if(r={...he,...r},e.prototype.__metadata__={name:"SERVICE"},r.deps.some(s=>s.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const t=Y(e,r.deps);m.register(e,t)},de=r=>{let e;switch(r.nodeName&&r.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(r.type)?e=r.checked?r.value!==null&&r.value!=="on"?r.value:!0:!1:e=r.value;break}case"select":{const t=r.type==="select-one",a=[...Array.from(r.options)].filter(n=>n.selected).map(n=>n.value??(n.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=t?a[0]:a;break}default:{e=r.value;break}}return e};class fe{constructor(e,t){w(this,"_initialValues");w(this,"_controls");w(this,"_errors",new Map);this._initialValues=e,this._controls=t}get errors(){return this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const e={};for(const[t,s]of Object.entries(this._controls))e[t]=s.value;return e}get(e){return this._controls[e]}reset(e={}){for(const t in this._controls)this._controls[t].value=e[t]||this._initialValues[t];return this._errors.clear(),this}_checkValidity(){this._errors.clear();for(const e in this._controls){const t=this._controls[e].value,s=this._controls[e].validators;this._controls[e].errors=null;for(const a of s){const n=a(t);n!==null&&(this._errors.has(e)?(this._errors.set(e,{...this._errors.get(e),...n}),this._controls[e].errors={...this._controls[e].errors,...n}):(this._errors.set(e,n),this._controls[e].errors=n))}}}}const me=r=>{const e={},t={};for(const[c,f]of Object.entries(r)){const v=Array.isArray(f)?f:[f];e[c]={value:v.shift(),validators:v},t[c]=e[c].value}const s=new fe(t,e);return[s,c=>f=>{const v=de(f.target);s.get(c).value=v},()=>s.reset()]},pe=r=>{let e=r;return[e,s=>{let a;S(s)?a=s(e):a=s,Object.assign(e,a)}]};class ge{static required(e){return e.length?null:{required:!0}}static min(e){return t=>t.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return t=>t.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return t=>new RegExp(e).test(t)?null:{pattern:!0}}}const be=r=>!!r&&typeof r.subscribe=="function",_e=r=>!!r&&typeof r.then=="function",ye=r=>({subscribe:e=>{e(r)}}),Se=r=>({subscribe:e=>{Promise.resolve(r).then(t=>{e(t)})}});class ve{asObservable(){return{subscribe:e=>this.subscribe(e)}}subscribe(e){return this.internalFn=e,this.unsubscribe}unsubscribe(){this._internalFn=null}next(e){this.internalFn(e)}}const Z=r=>be(r)?r:_e(r)?Se(Promise.resolve(r)):ye(r),H=class{static checkParams(e,t){let s=0;const a={},n=t.paramCount;for(let c=0;c<e.length;c++){const f=t.params[c];f.indexOf(":")>=0&&(a[f.split(":")[1]]=e[c].split("?")[0],s+=1)}return s===n?a:{}}static getParamCount(e){let t=0;return e.forEach(s=>{s.indexOf(":")>=0&&(t+=1)}),t}static formatRoute(e){const t={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:e.preload,canActivate:()=>!0};if(t.params=e.path.split("/").filter(s=>s.length>0),t.url=e.path,t.template="",t.redirectTo=e.redirectTo,e.template){if(!e.templatePath)throw Error("templatePath is required in route if template is mentioned.");t.template=e.template,t.templatePath=e.templatePath}e.canActivate&&(t.canActivate=e.canActivate),t.paramCount=H.getParamCount(t.params),H.routeList.push(t)}static preloadRoutes(){for(const e of H.routeList)e.templatePath&&e.templatePath()}static preloadSelectedRoutes(){const e=H.routeList.filter(t=>t.preload===!0);for(const t of e)t.templatePath&&t.templatePath()}};let P=H;w(P,"routeList",[]);class q{constructor(){w(this,"_currentRoute",{path:"",routeParams:new Map,queryParams:new Map,state:{}});w(this,"_template",new ve);w(this,"_unSubscribeHashEvent");w(this,"_routeStateMap",new Map)}startHashChange(){this._unSubscribeHashEvent=B(window,"hashchange",()=>{this._registerOnHashChange()})}stopHashChange(){this._unSubscribeHashEvent()}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute}navigateTo(e="",t){this._routeStateMap.clear(),e?(window.location.hash.replace(/^#/,"")===e&&this._navigateTo(e,t),this._routeStateMap.set(e,t),window.location.hash="#"+e):this._navigateTo(e,t)}_registerOnHashChange(){const e=window.location.hash.replace(/^#/,""),t=this._routeStateMap.get(e);this._navigateTo(e,t)}_routeMatcher(e,t){if(e){const s=new RegExp(e.replace(/:[^\s/]+/g,"([\\w-]+)"));return t.match(s)}else return e===t}_navigateTo(e,t){const s=e.split("/").filter(c=>c.length>0),a=P.routeList.filter(c=>{if(c.params.length===s.length&&this._routeMatcher(c.url,e))return c;if(c.url===e)return c}),n=a.length>0?a[0]:null;n&&(this._currentRoute.path=e,this._currentRoute.state={...t||{}},Z(n.canActivate()).subscribe(c=>{if(!c)return;const f=P.checkParams(s,n);if(Object.keys(f).length>0||e){this._currentRoute.routeParams=new Map(Object.entries(f));const v=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[];this._currentRoute.queryParams=new Map(v),n.isRegistered?this._template.next(n.template):n.templatePath&&Z(n.templatePath()).subscribe(()=>{n.isRegistered=!0,this._template.next(n.template)})}else this.navigateTo(n.redirectTo,t)}))}}$()(q);const we=()=>{class r{constructor(t){w(this,"_template","");w(this,"_subscriptions")}beforeMount(){this._subscriptions=this.internalRouterSrvc.getTemplate().subscribe(t=>{this._template=t}),this.internalRouterSrvc.startHashChange()}mount(){let t=window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(t)}unmount(){this._subscriptions(),this.internalRouterSrvc.stopHashChange()}render(){if(this._template){const t=[`${this._template}`];return t.raw=[`${this._template}`],W(t)}else return W``}}X({selector:"router-outlet",deps:[q]})(r)};class ee{constructor(e){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(e,t){this.internalRouter.navigateTo(e,t)}registerRoutes(e,t=!1){if(Array.isArray(e)){for(const s of e)P.formatRoute(s);t?P.preloadRoutes():P.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}$({deps:[q]})(ee),i.Component=X,i.Injectable=$,i.Renderer=K,i.Router=ee,i.Validators=ge,i.fromEvent=B,i.html=W,i.promisify=ce,i.registerRouterComponent=we,i.render=G,i.useFormFields=me,i.useState=pe,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
