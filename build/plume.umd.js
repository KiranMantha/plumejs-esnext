var Te=Object.defineProperty;var Ae=(c,p,R)=>p in c?Te(c,p,{enumerable:!0,configurable:!0,writable:!0,value:R}):c[p]=R;var g=(c,p,R)=>(Ae(c,typeof p!="symbol"?p+"":p,R),R),K=(c,p,R)=>{if(!p.has(c))throw TypeError("Cannot "+R)};var w=(c,p,R)=>(K(c,p,"read from private field"),R?R.call(c):p.get(c)),H=(c,p,R)=>{if(p.has(c))throw TypeError("Cannot add the same private member more than once");p instanceof WeakSet?p.add(c):p.set(c,R)},j=(c,p,R,D)=>(K(c,p,"write to private field"),D?D.call(c,R):p.set(c,R),R);var Q=(c,p,R)=>(K(c,p,"access private method"),R);(function(c,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c.PlumeJS={}))})(this,function(c){var M,oe;"use strict";const p=new(oe=class{constructor(){H(this,M,void 0);j(this,M,new WeakMap)}register(s,e){if(!w(this,M).get(s))w(this,M).set(s,e);else throw console.error(s),"service already exists"}getService(s){const e=w(this,M).get(s);if(e)return e;throw console.error(s),"service is not a registered service."}clear(){j(this,M,new WeakMap)}},M=new WeakMap,oe),R=s=>!!s&&typeof s.subscribe=="function",D=s=>!!s&&typeof s.then=="function",X=s=>{const e=s.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return e.length===3?e[1].split(",").map(t=>t.trim()):[]},le=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),ue=s=>({subscribe:e=>{e(s)}}),he=s=>({subscribe:e=>{Promise.resolve(s).then(t=>{e(t)})}});class B{constructor(){g(this,"_callbacks",[])}asObservable(){return{subscribe:e=>this.subscribe(e)}}subscribe(e){return this._callbacks.push(e),this.unsubscribe}unsubscribe(){this._callbacks=[]}next(e){for(const t of this._callbacks)t(e)}}class Z extends B{constructor(t){super();g(this,"_initialValue");this._initialValue=t}subscribe(t){const r=super.subscribe(t);return this.next(this._initialValue),r}}class ${constructor(){g(this,"_subcribers",[])}add(e){this._subcribers.push(e)}unsubscribe(){for(const e of this._subcribers)e();this._subcribers=[]}}const q=s=>R(s)?s:D(s)?he(Promise.resolve(s)):ue(s),W=(s,e,t,r=!1)=>(s.addEventListener(e,t,r),()=>{s.removeEventListener(e,t,r)}),de=s=>{const e=()=>new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),t=m=>{const b=m.querySelectorAll("script");for(const N of b)N.remove()},r=(m,b)=>{if(b=b.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(m)&&(b.includes("javascript:")||b.includes("data:"))||m.startsWith("on"))return!0},u=m=>{const b=m.attributes;for(const{name:N,value:x}of b)r(N,x)&&m.removeAttribute(N)},n=m=>{const b=m.children;for(const N of b)u(N),n(N)},o=e();return t(o),n(o),o.innerHTML},fe=function(s){s.renderCount===1&&queueMicrotask(()=>{s.update(),s.renderCount=0})},pe=(s,e)=>{const t=X(e),r=()=>({get(u,n){const o=Object.prototype.toString.call(u[n]);return["[object Object]","[object Array]"].indexOf(o)>-1&&!("__metadata__"in u[n])?new Proxy(u[n],r()):u[n]},set(u,n,o){return u[n]=o,++s.renderCount,fe(s),!0}});return class extends e{constructor(...u){return super(...u),u.forEach((n,o)=>{t[o]&&t[o]!=="undefined"&&(this[t[o]]=n)}),new Proxy(this,r())}}},me=()=>{let s;return[new Promise(t=>{s=t}),s]},ee=(s,e,t)=>{if(e.length>0){const r=[];for(const o of e)o.prototype.__metadata__.name!=="RENDERER"?r.push(p.getService(o)):r.push(t);const u=X(s),n=new s(...r);return e.forEach((o,m)=>{n[u[m]]=r[m]}),n}else return new s},F=new class{constructor(){g(this,"globalStyles");g(this,"globalStyleTag");g(this,"style_registry");g(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let e=[];const t=new CSSStyleSheet;if(t.insertRule(":host { display: block; }"),e=[this.globalStyles,t],s){const r=new CSSStyleSheet;r.replace(s),e.push(r)}return e}},{html:U,render:te}=(()=>{const s=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,e=/<[a-z][^>]+$/i,t="attr",r=/^attr([^ ]+)/,u="insertNode",n=/^insertNode([^ ]+)/;let o=[],m=[];const b=h=>{const i={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let d=JSON.stringify(h);const l=f=>i[f]||f;return d=(f=>f.replace(/[&<>\(\)]/g,l))(d),JSON.parse(d)},N=(h,i)=>{const d=h.options,l=Array.isArray(i)?i:[i];let S,f,a=d.length;for(;a--;){f=d[a];const y=f.getAttribute("value")??(f.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(f.selected=l.indexOf(y)>-1)&&(S=!0)}S||(h.selectedIndex=-1)},x=h=>{const i=document.createElement("template");return i.innerHTML=h,i.content},ie=(h,i)=>{const d=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,null);let l=d.nextNode();for(;l;){if(l.hasAttributes()){const S=Array.from(l.attributes).filter(f=>r.test(f.nodeName));for(const{nodeName:f,nodeValue:a}of S){const y=r.exec(f)[1];switch(!0){case/^on+/.test(a):{const v=a.slice(2).toLowerCase();l.removeEventListener(v,i[y]),l.addEventListener(v,i[y]);break}case/ref/.test(a):{const v=((k,L)=>{const I=k,G=L;return()=>{I.isConnected&&G(I)}})(l,i[y]);o.push(v);break}case/^data-+/.test(a):case/^aria-+/.test(a):{if(a==="data-input"){const v=((k,L)=>{const I=k,G=L;return()=>{if(I.isConnected){const Ce=new CustomEvent("bindprops",{detail:{props:G},bubbles:!1});I.dispatchEvent(Ce)}}})(l,i[y]);m.push(v)}else l.setAttribute(a,b(i[y]));break}case/class/.test(a):{i[y]?l.classList.add(...i[y].split(" ")):l.setAttribute("class","");break}case/value/.test(a):{l.nodeName.toLowerCase()==="select"?N(l,i[y]):l.value=b(i[y]);break}case/disabled/.test(a):case/checked/.test(a):{i[y]?l.setAttribute(a,i[y]):l.removeAttribute(a);break}default:l.setAttribute(a,b(i[y]))}l.removeAttribute(f)}}l=d.nextNode()}},_=(h,i)=>{const d=document.createTreeWalker(h,NodeFilter.SHOW_COMMENT,null);let l=d.nextNode(),S;for(;l;){if(S=n.exec(l.data)){const f=Array.isArray(i[S[1]])?i[S[1]]:[i[S[1]]];l.replaceWith(...f),d.currentNode=h}l=d.nextNode()}},T=(h,i)=>{if(!h||!i||h.nodeType!==1||i.nodeType!==1)return;const d=h.attributes,l=i.attributes,S=i.getAttribute("data-preserve-attributes"),f=S&&S==="true";for(const{name:a,value:y}of d)(!l[a]||l[a]!==y)&&i.setAttribute(a,y);if(!f)for(const{name:a}of l)d[a]||i.removeAttribute(a)},C=h=>h.nodeType===3?"text":h.nodeType===8?"comment":h.tagName.toLowerCase(),P=h=>h.childNodes&&h.childNodes.length>0?null:h.textContent,A=(h,i,d)=>{const l=i?Array.from(i.childNodes):[],S=h?Array.from(h.childNodes):[];let f=l.length-S.length;if(f>0)for(;f>0;f--)l[l.length-f].parentNode.removeChild(l[l.length-f]);S.forEach(function(a,y){const v=l[y];if(d&&v&&v.nodeType===1&&v.tagName.indexOf("-")>-1)return;if(T(a,v),!v){i&&i.appendChild(a);return}if(C(a)!==C(v)){v.replaceWith(a);return}const k=P(a);if(k&&k!==P(v)){v.textContent=k;return}if(v.childNodes.length>0&&a.childNodes.length<1){v.innerHTML="";return}if(v.childNodes.length<1&&a.childNodes.length>0){const L=document.createDocumentFragment();A(a,L,!1),v.appendChild(L);return}if(a.childNodes.length>0){A(a,v,!0);return}})};return{html:(h,...i)=>{let d="";const{length:l}=h;for(let f=1;f<l;f++){const a=i[f-1];let y=!1;if(d+=h[f-1],s.test(d)&&e.test(d)&&(d=d.replace(s,(v,k,L)=>`${t}${f-1}=${L||'"'}${k}${L?"":'"'}`),y=!0),!y)switch(!0){case Array.isArray(a):case a instanceof DocumentFragment:{d+=`<!--${u}${f-1}-->`;break}case(typeof a=="object"&&a!==null):{"html"in a&&(d+=a.html);break}default:d+=a}}d+=h[l-1];const S=x(d.trim());return ie(S,i),_(S,i),S},render:(h,i)=>{h&&!h.children.length?(h.innerHTML="",h.appendChild(i)):A(i,h,!1),o.forEach(d=>{d()}),o=[],m.forEach(d=>{d()}),m=[]}}})();class z{constructor(e,t){g(this,"_shadowRoot");g(this,"_hostElement");g(this,"update");g(this,"emitEvent");this._hostElement=e,this._shadowRoot=t}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const be={selector:"",root:!1,styles:"",deps:[],standalone:!1,encapsulation:"shadowDom"},se=(s,e)=>{const t=document.createElement("style");return t.innerHTML=s,e&&e.appendChild(t),t},ge=(s,e)=>{var t,r,u,n,o,ae,b,ce,x;if(s={...be,...s},s.styles=s.styles.toString(),s.root&&!F.isRootNodeSet)F.isRootNodeSet=!0,s.styles&&(F.globalStyles.replace(s.styles),F.globalStyleTag=se(s.styles,document.head));else if(s.root&&F.isRootNodeSet)throw Error("Cannot register duplicate root component in "+s.selector+" component");window.customElements.define(s.selector,(x=class extends HTMLElement{constructor(){super();H(this,o);H(this,b);H(this,t,void 0);H(this,r,void 0);H(this,u,void 0);g(this,"renderCount",0);H(this,n,new $);if(le)j(this,r,this.attachShadow({mode:"open"})),w(this,r).adoptedStyleSheets=F.getComputedCss(s.styles,s.standalone);else{j(this,r,this);const _=s.styles.replaceAll(":host",s.selector);j(this,u,se(_,document.head))}Q(this,o,ae).call(this),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this)}static get observedAttributes(){return e.observedAttributes||[]}update(){const _=w(this,t).render();typeof _=="string"?w(this,r).innerHTML=de(_):te(w(this,r),_)}setProps(_){var T,C;for(const[P,A]of Object.entries(_))e.observedProperties.find(O=>O===P)&&(w(this,t)[P]=A);(C=(T=w(this,t)).onPropertiesChanged)==null||C.call(T)}getInstance(){return w(this,t)}connectedCallback(){var _,T,C,P;w(this,n).add(W(this,"bindprops",A=>{const O=A.detail.props;O&&this.setProps(O)})),w(this,n).add(W(this,"refresh_component",()=>{var A,O;(O=(A=w(this,t)).mount)==null||O.call(A)})),(T=(_=w(this,t)).beforeMount)==null||T.call(_),this.update(),(P=(C=w(this,t)).mount)==null||P.call(C)}attributeChangedCallback(_,T,C){var P,A;(A=(P=w(this,t)).onAttributesChanged)==null||A.call(P,_,T,C)}disconnectedCallback(){var _,T,C;this.renderCount=1,(T=(_=w(this,t)).unmount)==null||T.call(_),(C=w(this,u))==null||C.remove(),w(this,n).unsubscribe()}},t=new WeakMap,r=new WeakMap,u=new WeakMap,n=new WeakMap,o=new WeakSet,ae=function(){const _=new z(this,w(this,r));_.update=()=>{this.update()},_.emitEvent=(T,C)=>{Q(this,b,ce).call(this,T,C)},j(this,t,ee(pe(this,e),s.deps,_))},b=new WeakSet,ce=function(_,T){const C=new CustomEvent(_,{detail:T});this.dispatchEvent(C)},x))},_e={deps:[]},re=s=>e=>{if(s.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(s.selector)||ge(s,e)},J=(s={})=>e=>{if(s={..._e,...s},e.prototype.__metadata__={name:"SERVICE"},s.deps.some(r=>r.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const t=ee(e,s.deps);p.register(e,t)},ye=s=>{let e;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?e=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:e=s.value;break}case"select":{const t=s.type==="select-one",u=[...Array.from(s.options)].filter(n=>n.selected).map(n=>n.value??(n.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=t?u[0]:u;break}default:{e=s.value;break}}return e};class ve{constructor(e,t){g(this,"_initialValues");g(this,"_controls");g(this,"_errors",new Map);this._initialValues=e,this._controls=t}get errors(){return this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const e={};for(const[t,r]of Object.entries(this._controls))e[t]=r.value;return e}get(e){return this._controls[e]}reset(e={}){for(const t in this._controls)this._controls[t].value=e[t]||this._initialValues[t];return this._errors.clear(),this}_checkValidity(){this._errors.clear();for(const e in this._controls){const t=this._controls[e].value,r=this._controls[e].validators;this._controls[e].errors=null;for(const u of r){const n=u(t);n!==null&&(this._errors.has(e)?(this._errors.set(e,{...this._errors.get(e),...n}),this._controls[e].errors={...this._controls[e].errors,...n}):(this._errors.set(e,n),this._controls[e].errors=n))}}}}const we=s=>{const e={},t={};for(const[o,m]of Object.entries(s)){const b=Array.isArray(m)?m:[m];e[o]={value:b.shift(),validators:b},t[o]=e[o].value}const r=new ve(t,e);return[r,o=>m=>{const b=ye(m.target);r.get(o).value=b},()=>r.reset()]};class Re{static required(e){return e.length?null:{required:!0}}static min(e){return t=>t.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return t=>t.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return t=>new RegExp(e).test(t)?null:{pattern:!0}}}const V=class{static checkParams(e,t){let r=0;const u={},n=t.paramCount;for(let o=0;o<e.length;o++){const m=t.params[o];m.indexOf(":")>=0&&(u[m.split(":")[1]]=e[o].split("?")[0],r+=1)}return r===n?u:{}}static getParamCount(e){let t=0;return e.forEach(r=>{r.indexOf(":")>=0&&(t+=1)}),t}static formatRoute(e){const t={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:e.preload,canActivate:()=>!0};if(t.params=e.path.split("/").filter(r=>r.length>0),t.url=e.path,t.template="",t.redirectTo=e.redirectTo,e.template){if(!e.templatePath)throw Error("templatePath is required in route if template is mentioned.");t.template=e.template,t.templatePath=e.templatePath}e.canActivate&&(t.canActivate=e.canActivate),t.paramCount=V.getParamCount(t.params),V.routeList.push(t)}static preloadRoutes(){for(const e of V.routeList)e.templatePath&&e.templatePath()}static preloadSelectedRoutes(){const e=V.routeList.filter(t=>t.preload===!0);for(const t of e)t.templatePath&&t.templatePath()}};let E=V;g(E,"routeList",[]),g(E,"isHistoryBasedRouting",!0);function Se(s,e){return s?new RegExp(s.replace(/:[^\s/]+/g,"(.+)")).test(e):!1}class Y{constructor(){g(this,"_currentRoute",{path:"",routeParams:new Map,queryParams:new Map,state:{}});g(this,"_template",new Z(""));g(this,"_navigationEndEvent",new B);g(this,"_routeStateMap",new Map)}listenRouteChanges(){const e=E.isHistoryBasedRouting?"popstate":"hashchange";return E.isHistoryBasedRouting&&(window.history.replaceState({},null,""),function(t,r){var u=t.pushState;t.pushState=function(...n){u.apply(t,n),r()}}(window.history,this._registerOnHashChange.bind(this))),W(window,e,()=>{this._registerOnHashChange()})}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute}navigateTo(e="/",t){let r=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");r=r||"/",this._routeStateMap.clear(),this._routeStateMap.set(e,t),r===e?this._navigateTo(e,t):E.isHistoryBasedRouting?window.history.pushState(t,"",e):window.location.hash="#"+e}onNavigationEnd(){return this._navigationEndEvent.asObservable()}_registerOnHashChange(){const e=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,""),t=this._routeStateMap.get(e);this._navigateTo(e,t)}_navigateTo(e,t){const r=e.split("/").filter(o=>o.length>0),u=E.routeList.filter(o=>{if(o.params.length===r.length&&Se(o.url,e))return o;if(o.url===e)return o}),n=u.length>0?u[0]:null;n&&(this._currentRoute.path=e,this._currentRoute.state={...t||{}},q(n.canActivate()).subscribe(o=>{if(!o)return;const m=E.checkParams(r,n);if(Object.keys(m).length>0||e){this._currentRoute.routeParams=new Map(Object.entries(m));let b=[];E.isHistoryBasedRouting?b=new URLSearchParams(window.location.search).entries():b=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[],this._currentRoute.queryParams=new Map(b);const N=x=>{x.isRegistered=!0,this._template.next(x.template),this._navigationEndEvent.next()};n.isRegistered?N(n):n.templatePath?q(n.templatePath()).subscribe(()=>{N(n)}):n.redirectTo&&this.navigateTo(n.redirectTo,t)}else this.navigateTo(n.redirectTo,t)}))}}J()(Y);const Ee=()=>{class s{constructor(t,r){g(this,"_template","");g(this,"_subscriptions",new $)}beforeMount(){this._subscriptions.add(this.internalRouterSrvc.getTemplate().subscribe(t=>{this._template!==t?this._template=t:this.refreshRouterOutletComponent()})),this._subscriptions.add(this.internalRouterSrvc.listenRouteChanges())}mount(){const t=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(t||"/")}unmount(){this._subscriptions.unsubscribe()}refreshRouterOutletComponent(){if(this.renderer.shadowRoot.children.length){const t=new CustomEvent("refresh_component",{detail:{},bubbles:!1,cancelable:!1,composed:!1});this.renderer.shadowRoot.children[0].dispatchEvent(t)}}render(){if(this._template){const t=[`${this._template}`];return t.raw=[`${this._template}`],U(t)}else return U``}}re({selector:"router-outlet",deps:[Y,z]})(s)};class ne{constructor(e){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(e,t){this.internalRouter.navigateTo(e,t)}onNavigationEnd(){return this.internalRouter.onNavigationEnd()}registerRoutes(e,t=!1,r=!1){if(r&&(E.isHistoryBasedRouting=!r),Array.isArray(e)){for(const u of e)E.formatRoute(u);t?E.preloadRoutes():E.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}J({deps:[Y]})(ne),c.BehaviourSubjectObs=Z,c.Component=re,c.Injectable=J,c.Renderer=z,c.Router=ne,c.SubjectObs=B,c.Subscriptions=$,c.Validators=Re,c.fromEvent=W,c.html=U,c.promisify=me,c.registerRouterComponent=Ee,c.render=te,c.useFormFields=we,c.wrapIntoObservable=q,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
