var Me=Object.defineProperty;var Fe=(u,b,v)=>b in u?Me(u,b,{enumerable:!0,configurable:!0,writable:!0,value:v}):u[b]=v;var L=(u,b,v)=>(Fe(u,typeof b!="symbol"?b+"":b,v),v),se=(u,b,v)=>{if(!b.has(u))throw TypeError("Cannot "+v)};var n=(u,b,v)=>(se(u,b,"read from private field"),v?v.call(u):b.get(u)),C=(u,b,v)=>{if(b.has(u))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(u):b.set(u,v)},P=(u,b,v,W)=>(se(u,b,"write to private field"),W?W.call(u,v):b.set(u,v),v);var O=(u,b,v)=>(se(u,b,"access private method"),v);(function(u,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(u=typeof globalThis<"u"?globalThis:u||self,b(u.PlumeJS={}))})(this,function(u){var k,he,$,q,D,R,T,J,fe,M,I,z,B,me,Y,ge,V,K;"use strict";const b=new(he=class{constructor(){C(this,k,void 0);P(this,k,new WeakMap)}register(t,e){if(!n(this,k).get(t))n(this,k).set(t,e);else throw console.error(t),"service already exists"}getService(t){const e=n(this,k).get(t);if(e)return e;throw console.error(t),"service is not a registered service."}clear(){P(this,k,new WeakMap)}},k=new WeakMap,he),v=t=>typeof t=="function",W=t=>{const e=t.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return e.length===3?e[1].split(",").map(s=>s.trim()):[]},Q=(()=>{try{return new CSSStyleSheet,!1}catch{return!0}})(),re=(t,e,s,r=!1)=>(t.addEventListener(e,s,r),()=>{t.removeEventListener(e,s,r)}),be=t=>{const e=()=>new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),s=i=>{const g=i.querySelectorAll("script");for(const S of g)S.remove()},r=(i,g)=>{if(g=g.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(i)&&(g.includes("javascript:")||g.includes("data:"))||i.startsWith("on"))return!0},c=i=>{const g=i.attributes;for(const{name:S,value:A}of g)r(S,A)&&i.removeAttribute(S)},o=i=>{const g=i.children;for(const S of g)c(S),o(S)},h=e();return s(h),o(h),h.innerHTML},pe=function(t){t.debounce&&window.cancelAnimationFrame(t.debounce),t.debounce=window.requestAnimationFrame(function(){t.update()})},ye=(t,e)=>{const s=W(e);return t.debounce=null,class extends e{constructor(...r){return super(...r),r.forEach((c,o)=>{this[s[o]]=c}),new Proxy(this,{get(c,o,h){window.debug&&console.log("proxiedklass getter",c,o);try{return Reflect.get(c,o,h)}catch{return this[o]}},set(c,o,h,i){window.debug&&console.log("proxiedklass setter",c,o);try{Reflect.set(c,o,h,i)}catch{this[o]=h}return pe(t),!0},deleteProperty(c,o){window.debug&&console.log("proxiedklass deleteprop"),Reflect.deleteProperty(c,o)}})}}},ne=(t,e,s)=>{if(e.length>0){const r=[];for(const h of e)h.__metadata__?r.push(s):r.push(b.getService(h));const c=W(t),o=new t(...r);return e.forEach((h,i)=>{o[c[i]]=r[i]}),o}else return new t},N=new class{constructor(){L(this,"globalStyles");L(this,"globalStyleTag");L(this,"style_registry");L(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(t=""){let e=[];const s=new CSSStyleSheet;if(s.insertRule(":host { display: block; }"),e=[this.globalStyles,s],t){const r=new CSSStyleSheet;r.replace(t),e.push(r)}return e}},{html:X,render:ie}=(()=>{const t=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,e=/<[a-z][^>]+$/i,s="attr",r=/^attr([^ ]+)/,c="insertNode",o=/^insertNode([^ ]+)/;let h=[];const i=d=>{const a={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let m=JSON.stringify(d);const f=l=>a[l]||l;return m=(l=>l.replace(/[&<>\(\)]/g,f))(m),JSON.parse(m)},g=(d,a)=>{const m=d.options,f=Array.isArray(a)?a:[a];let p,l,y=m.length;for(;y--;){l=m[y];const w=l.getAttribute("value")??(l.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(l.selected=f.indexOf(w)>-1)&&(p=!0)}p||(d.selectedIndex=-1)},S=d=>{const a=document.createElement("template");return a.innerHTML=d,a.content},A=(d,a)=>{const m=document.createTreeWalker(d,NodeFilter.SHOW_ELEMENT,null);let f=m.nextNode();for(;f;){if(f.hasAttributes()){const p=Array.from(f.attributes).filter(l=>r.test(l.nodeName));for(const{nodeName:l,nodeValue:y}of p){const w=r.exec(l)[1];switch(!0){case/^on+/.test(y):{const E=y.slice(2).toLowerCase();f.removeEventListener(E,a[w]),E!=="bindprops"?f.addEventListener(E,a[w]):f.addEventListener(E,F=>{F.detail.setProps(a[w]())});break}case/ref/.test(y):{const E=(F=>{const U=F;return()=>{U.isConnected&&a[w](U)}})(f);h.push(E);break}case/^data-+/.test(y):case/^aria-+/.test(y):{f.setAttribute(y,i(a[w]));break}case/class/.test(y):{a[w]?f.classList.add(...a[w].split(" ")):f.setAttribute("class","");break}case/value/.test(y):{f.nodeName.toLowerCase()==="select"?g(f,a[w]):f.value=i(a[w]);break}case/disabled/.test(y):case/checked/.test(y):{a[w]?f.setAttribute(y,a[w]):f.removeAttribute(y);break}default:f.setAttribute(y,i(a[w]))}f.removeAttribute(l)}}f=m.nextNode()}},x=(d,a)=>{const m=document.createTreeWalker(d,NodeFilter.SHOW_COMMENT,null);let f=m.nextNode(),p;for(;f;){if(p=o.exec(f.data)){const l=Array.isArray(a[p[1]])?a[p[1]]:[a[p[1]]];f.replaceWith(...l),m.currentNode=d}f=m.nextNode()}},H=(d,a)=>{if(!d||!a||d.nodeType!==1||a.nodeType!==1)return;const m=d.attributes,f=a.attributes;for(const{name:p,value:l}of m)/class/.test(p)?Array.from(d.classList).every(y=>{a.classList.contains(y)||a.classList.add(y)}):(!f[p]||f[p]!==l)&&a.setAttribute(p,l);for(const{name:p}of f)/class/.test(p)?Array.from(a.classList).every(l=>{d.classList.contains(l)||a.classList.remove(l)}):m[p]||a.removeAttribute(p)},G=d=>d.nodeType===3?"text":d.nodeType===8?"comment":d.tagName.toLowerCase(),de=d=>d.childNodes&&d.childNodes.length>0?null:d.textContent,te=(d,a)=>{const m=a?Array.from(a.childNodes):[],f=d?Array.from(d.childNodes):[];let p=m.length-f.length;if(p>0)for(;p>0;p--)m[m.length-p].parentNode.removeChild(m[m.length-p]);f.forEach(function(l,y){const w=m[y];if(H(l,w),!w){a&&a.appendChild(l);return}if(G(l)!==G(w)){w.replaceWith(l);return}const E=de(l);if(E&&E!==de(w)){w.textContent=E;return}if(w.childNodes.length>0&&l.childNodes.length<1){w.innerHTML="";return}if(w.childNodes.length<1&&l.childNodes.length>0){const F=document.createDocumentFragment();te(l,F),w.appendChild(F);return}if(l.childNodes.length>0){te(l,w);return}})};return{html:(d,...a)=>{let m="";const{length:f}=d;for(let l=1;l<f;l++){const y=a[l-1];let w=!1;if(m+=d[l-1],t.test(m)&&e.test(m)&&(m=m.replace(t,(E,F,U)=>`${s}${l-1}=${U||'"'}${F}${U?"":'"'}`),w=!0),!w)switch(!0){case Array.isArray(y):case y instanceof DocumentFragment:{m+=`<!--${c}${l-1}-->`;break}case(typeof y=="object"&&y!==null):{"html"in y&&(m+=y.html);break}default:m+=y}}m+=d[f-1];const p=S(m.trim());return A(p,a),x(p,a),p},render:(d,a)=>{d&&!d.children.length?(d.innerHTML="",d.appendChild(a)):te(a,d),h.forEach(m=>{m()}),h=[]}}})();class oe{constructor(e,s){C(this,$,void 0);C(this,q,void 0);L(this,"emitEvent");P(this,q,e),P(this,$,s)}static get __metadata__(){return{name:"Renderer"}}get shadowRoot(){return n(this,$)}get hostElement(){return n(this,q)}}$=new WeakMap,q=new WeakMap;const we={selector:"",root:!1,styles:"",deps:[],standalone:!1},ae=(t,e)=>{const s=document.createElement("style");return s.innerHTML=t,e&&e.appendChild(s),s},ve=(t,e)=>{var s,r,c,o;if(t={...we,...t},t.styles=t.styles.toString(),t.root&&!N.isRootNodeSet)N.isRootNodeSet=!0,t.styles&&(N.globalStyles.replace(t.styles),N.globalStyleTag=ae(t.styles,document.head));else if(t.root&&N.isRootNodeSet)throw Error("Cannot register duplicate root component in "+t.selector+" component");window.customElements.define(t.selector,(o=class extends HTMLElement{constructor(){super();C(this,s,void 0);C(this,r,void 0);C(this,c,void 0);P(this,r,this.attachShadow({mode:"open"})),Q||(n(this,r).adoptedStyleSheets=N.getComputedCss(t.styles,t.standalone)),this.getInstance=this.getInstance.bind(this)}static get observedAttributes(){return e.observedAttributes||[]}emulateComponent(){Q&&t.styles&&P(this,c,ae(t.styles))}update(){const i=n(this,s).render();typeof i=="string"?n(this,r).innerHTML=be(i):ie(n(this,r),i),Q&&(t.styles&&n(this,r).insertBefore(n(this,c),n(this,r).childNodes[0]),N.globalStyleTag&&!t.standalone&&n(this,r).insertBefore(document.importNode(N.globalStyleTag,!0),n(this,r).childNodes[0]))}emitEvent(i,g){const S=new CustomEvent(i,{detail:g});this.dispatchEvent(S)}setProps(i){var g,S;for(const[A,x]of Object.entries(i))e.observedProperties.find(H=>H===A)&&(n(this,s)[A]=x);(S=(g=n(this,s)).onPropertiesChanged)==null||S.call(g)}getInstance(){return n(this,s)}connectedCallback(){var g,S,A,x;this.emulateComponent();const i=new oe(this,n(this,r));i.emitEvent=(H,G)=>{this.emitEvent(H,G)},P(this,s,ne(ye(this,e),t.deps,i)),(S=(g=n(this,s)).beforeMount)==null||S.call(g),(x=(A=n(this,s)).mount)==null||x.call(A),this.emitEvent("bindprops",{setProps:H=>{this.setProps(H)}},!1)}attributeChangedCallback(i,g,S){var A,x;(x=(A=n(this,s)).onAttributesChanged)==null||x.call(A,i,g,S)}disconnectedCallback(){var i,g;(g=(i=n(this,s)).unmount)==null||g.call(i)}},s=new WeakMap,r=new WeakMap,c=new WeakMap,o))},Se={deps:[]},ce=t=>e=>{if(t.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(t.selector)||ve(t,e)},Z=(t={})=>e=>{if(t={...Se,...t},t.deps.some(r=>{var c;return((c=r.__metadata__)==null?void 0:c.name)==="Renderer"}))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const s=ne(e,t.deps);b.register(e,s)},Ce=t=>{let e;switch(t.nodeName&&t.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(t.type)?e=t.checked?t.value!==null&&t.value!=="on"?t.value:!0:!1:e=t.value;break}case"select":{const s=t.type==="select-one",c=[...Array.from(t.options)].filter(o=>o.selected).map(o=>o.value??(o.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=s?c[0]:c;break}default:{e=t.value;break}}return e};class Re{constructor(e,s){C(this,J);C(this,D,void 0);C(this,R,void 0);C(this,T,new Map);P(this,D,e),P(this,R,s)}get errors(){return n(this,T)}get valid(){return O(this,J,fe).call(this),!n(this,T).size}get value(){const e={};for(const[s,r]of Object.entries(n(this,R)))e[s]=r.value;return e}get(e){return n(this,R)[e]}reset(e={}){for(const s in n(this,R))n(this,R)[s].value=e[s]||n(this,D)[s];n(this,T).clear()}}D=new WeakMap,R=new WeakMap,T=new WeakMap,J=new WeakSet,fe=function(){n(this,T).clear();for(const e in n(this,R)){const s=n(this,R)[e].value,r=n(this,R)[e].validators;n(this,R)[e].errors=null;for(const c of r){const o=c(s);o!==null&&(n(this,T).has(e)?(n(this,T).set(e,{...n(this,T).get(e),...o}),n(this,R)[e].errors={...n(this,R)[e].errors,...o}):(n(this,T).set(e,o),n(this,R)[e].errors=o))}}};const Ae=t=>{const e={},s={};for(const[h,i]of Object.entries(t)){const g=Array.isArray(i)?i:[i];e[h]={value:g.shift(),validators:g},s[h]=e[h].value}const r=new Re(s,e);return[r,h=>i=>{const g=Ce(i.target);r.get(h).value=g},()=>{r.reset()}]},Te=t=>{let e=t;return[e,r=>{let c;v(r)?c=r(e):c=r,Object.assign(e,c)}]};class Ee{static required(e){return e.length?null:{required:!0}}static min(e){return s=>s.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return s=>s.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return s=>new RegExp(e).test(s)?null:{pattern:!0}}}const Pe=t=>!!t&&typeof t.subscribe=="function",Le=t=>!!t&&typeof t.then=="function",xe=t=>({subscribe:e=>{e(t)}}),Ne=t=>({subscribe:e=>{Promise.resolve(t).then(s=>{e(s)})}});class _e{asObservable(){return{subscribe:e=>this.subscribe(e)}}subscribe(e){return this.internalFn=e,this.unsubscribe}unsubscribe(){this._internalFn=null}next(e){this.internalFn(e)}}const le=t=>Pe(t)?t:Le(t)?Ne(Promise.resolve(t)):xe(t),j=class{static checkParams(e,s){let r=0;const c={},o=s.paramCount;for(let h=0;h<e.length;h++){const i=s.params[h];i.indexOf(":")>=0&&(c[i.split(":")[1]]=e[h].split("?")[0],r+=1)}return r===o?c:{}}static getParamCount(e){let s=0;return e.forEach(r=>{r.indexOf(":")>=0&&(s+=1)}),s}static formatRoute(e){const s={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:e.preload,canActivate:()=>!0};if(s.params=e.path.split("/").filter(r=>r.length>0),s.url=e.path,s.template="",s.redirectTo=e.redirectTo,e.template){if(!e.templatePath)throw Error("templatePath is required in route if template is mentioned.");s.template=e.template,s.templatePath=e.templatePath}e.canActivate&&(s.canActivate=e.canActivate),s.paramCount=j.getParamCount(s.params),j.routeList.push(s)}static preloadRoutes(){for(const e of j.routeList)e.templatePath&&e.templatePath()}static preloadSelectedRoutes(){const e=j.routeList.filter(s=>s.preload===!0);for(const s of e)s.templatePath&&s.templatePath()}};let _=j;L(_,"routeList",[]);class ee{constructor(){C(this,B);C(this,Y);C(this,V);C(this,M,{path:"",routeParams:new Map,queryParams:new Map,state:{}});C(this,I,new _e);C(this,z,void 0)}startHashChange(){P(this,z,re(window,"hashchange",()=>{O(this,B,me).call(this)}))}stopHashChange(){n(this,z).call(this)}getTemplate(){return n(this,I).asObservable()}getCurrentRoute(){return n(this,M)}navigateTo(e="",s){e?(window.location.hash.replace(/^#/,"")===e&&O(this,V,K).call(this,e,s),window.location.hash="#"+e):O(this,V,K).call(this,e,s)}}M=new WeakMap,I=new WeakMap,z=new WeakMap,B=new WeakSet,me=function(){const e=window.location.hash.replace(/^#/,"");O(this,V,K).call(this,e,null)},Y=new WeakSet,ge=function(e,s){if(e){const r=new RegExp(e.replace(/:[^\s/]+/g,"([\\w-]+)"));return s.match(r)}else return e===s},V=new WeakSet,K=function(e,s){const r=e.split("/").filter(h=>h.length>0),c=_.routeList.filter(h=>{if(h.params.length===r.length&&O(this,Y,ge).call(this,h.url,e))return h;if(h.url===e)return h}),o=c.length>0?c[0]:null;o&&(n(this,M).path=e,n(this,M).state={...s||{}},le(o.canActivate()).subscribe(h=>{if(!h)return;const i=_.checkParams(r,o);if(Object.keys(i).length>0||e){n(this,M).routeParams=new Map(Object.entries(i));const g=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[];n(this,M).queryParams=new Map(g),o.isRegistered?n(this,I).next(o.template):o.templatePath&&le(o.templatePath()).subscribe(()=>{o.isRegistered=!0,n(this,I).next(o.template)})}else this.navigateTo(o.redirectTo,s)}))},Z()(ee);const ke=()=>{class t{constructor(s){L(this,"template","");L(this,"subscriptions");L(this,"update")}beforeMount(){this.subscriptions=this.internalRouterSrvc.getTemplate().subscribe(s=>{this.template=s}),this.internalRouterSrvc.startHashChange()}mount(){let s=window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(s)}unmount(){this.subscriptions(),this.internalRouterSrvc.stopHashChange()}render(){if(this.template){const s=[`${this.template}`];return s.raw=[`${this.template}`],X(s)}else return X``}}ce({selector:"router-outlet",deps:[ee]})(t)};class ue{constructor(e){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(e,s){this.internalRouter.navigateTo(e,s)}registerRoutes(e,s=!1){if(Array.isArray(e)){for(const r of e)_.formatRoute(r);s?_.preloadRoutes():_.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}Z({deps:[ee]})(ue),u.Component=ce,u.Injectable=Z,u.Renderer=oe,u.Router=ue,u.Validators=Ee,u.fromEvent=re,u.html=X,u.registerRouterComponent=ke,u.render=ie,u.useFormFields=Ae,u.useState=Te,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
