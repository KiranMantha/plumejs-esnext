var kt=Object.defineProperty;var xt=(c,b,S)=>b in c?kt(c,b,{enumerable:!0,configurable:!0,writable:!0,value:S}):c[b]=S;var y=(c,b,S)=>(xt(c,typeof b!="symbol"?b+"":b,S),S),K=(c,b,S)=>{if(!b.has(c))throw TypeError("Cannot "+S)};var _=(c,b,S)=>(K(c,b,"read from private field"),S?S.call(c):b.get(c)),M=(c,b,S)=>{if(b.has(c))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(c):b.set(c,S)},H=(c,b,S,N)=>(K(c,b,"write to private field"),N?N.call(c,S):b.set(c,S),S);var Q=(c,b,S)=>(K(c,b,"access private method"),S);(function(c,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(c=typeof globalThis<"u"?globalThis:c||self,b(c.PlumeJS={}))})(this,function(c){var x,it;"use strict";const b=s=>typeof s=="function",S=Object.create(null);let N=null;function ct(){return Math.random().toString(36).substring(2)}function lt(s,t){const e=N;let r;N=ct(),S[N]=s;try{t()}finally{r=N,N=e}return r}function ut(s){const t=S[N];let e=s;function r(){return e}return r.set=function(o){b(o)?e=o(e):e=o,queueMicrotask(()=>{t()})},r}function ht(s,t){const e=lt(s,t);return function(){delete S[e]}}const X=new(it=class{constructor(){M(this,x,void 0);H(this,x,new WeakMap)}register(s,t){if(!_(this,x).get(s))_(this,x).set(s,t);else throw console.error(s),"service already exists"}getService(s){const t=_(this,x).get(s);if(t)return t;throw console.error(s),"service is not a registered service."}clear(){H(this,x,new WeakMap)}},x=new WeakMap,it),dt=s=>!!s&&typeof s.subscribe=="function",ft=s=>!!s&&typeof s.then=="function",Z=s=>{const t=s.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return t.length===3?t[1].split(",").map(e=>e.trim()):[]},pt=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),bt=s=>({subscribe:t=>{t(s)}}),gt=s=>({subscribe:t=>{Promise.resolve(s).then(e=>{t(e)})}}),mt=()=>Math.random().toString(36).substring(2);class W{constructor(){y(this,"_callbackCollection",{})}unsubscribe(t){delete this._callbackCollection[t]}asObservable(){return{subscribe:t=>this.subscribe(t)}}subscribe(t){const e=mt();return this._callbackCollection[e]=t,()=>this.unsubscribe(e)}next(t){for(const e in this._callbackCollection)this._callbackCollection[e](t)}}class $ extends W{constructor(e){super();y(this,"_initialValue");this._initialValue=e}subscribe(e){const r=super.subscribe(e);return super.next(this._initialValue),r}next(e){this._initialValue=e,super.next(e)}}class q{constructor(){y(this,"_subcribers",[])}add(t){this._subcribers.push(t)}unsubscribe(){for(const t of this._subcribers)t();this._subcribers=[]}}const J=s=>dt(s)?s:ft(s)?gt(Promise.resolve(s)):bt(s),B=(s,t,e,r=!1)=>(s.addEventListener(t,e,r),()=>{s.removeEventListener(t,e,r)}),yt=s=>{const t=()=>new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),e=p=>{const v=p.querySelectorAll("script");for(const P of v)P.remove()},r=(p,v)=>{if(v=v.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(p)&&(v.includes("javascript:")||v.includes("data:"))||p.startsWith("on"))return!0},o=p=>{const v=p.attributes;for(const{name:P,value:k}of v)r(P,k)&&p.removeAttribute(P)},u=p=>{const v=p.children;for(const P of v)o(P),u(P)},h=t();return e(h),u(h),h.innerHTML},_t=function(s){s.renderCount===1&&queueMicrotask(()=>{s.update(),s.renderCount=0})},vt=(s,t)=>{const e=Z(t),r=()=>({get(o,u){const h=Object.prototype.toString.call(o[u]);return["[object Object]","[object Array]"].indexOf(h)>-1&&!("__metadata__"in o[u])?new Proxy(o[u],r()):o[u]},set(o,u,h){return o[u]=h,++s.renderCount,_t(s),!0}});return class extends t{constructor(...o){return super(...o),o.forEach((u,h)=>{e[h]&&e[h]!=="undefined"&&(this[e[h]]=u)}),new Proxy(this,r())}}},wt=()=>{let s;return[new Promise(e=>{s=e}),s]},tt=(s,t,e)=>{if(t.length>0){const r=[];for(const h of t)h.prototype.__metadata__.name!=="RENDERER"?r.push(X.getService(h)):r.push(e);const o=Z(s),u=new s(...r);return t.forEach((h,p)=>{u[o[p]]=r[p]}),u}else return new s},j=new class{constructor(){y(this,"globalStyles");y(this,"globalStyleTag");y(this,"style_registry");y(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let t=[];const e=new CSSStyleSheet;if(e.insertRule(":host { display: block; }"),t=[this.globalStyles,e],s){const r=new CSSStyleSheet;r.replace(s),t.push(r)}return t}},{html:U,render:et}=(()=>{const s=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,t=/<[a-z][^>]+$/i,e="attr",r=/^attr([^ ]+)/,o="insertNode",u=/^insertNode([^ ]+)/;let h=[],p=[];const v=a=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let d=JSON.stringify(a);const l=f=>n[f]||f;return d=(f=>f.replace(/[&<>\(\)]/g,l))(d),JSON.parse(d)},P=(a,n)=>{const d=a.options,l=Array.isArray(n)?n:[n];let C,f,i=d.length;for(;i--;){f=d[i];const g=f.getAttribute("value")??(f.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(f.selected=l.indexOf(g)>-1)&&(C=!0)}C||(a.selectedIndex=-1)},k=a=>{const n=document.createElement("template");return n.innerHTML=a,n.content},V=(a,n,d)=>{const l=()=>{setTimeout(()=>{if(a.isConnected){const C=new CustomEvent("bindprops",{detail:{props:n},bubbles:!1});a.dispatchEvent(C)}})};a[d]=JSON.stringify(n),p.push(l)},w=(a,n)=>{const d=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT,null);let l=d.nextNode();for(;l;){if(l.hasAttributes()){const C=Array.from(l.attributes).filter(f=>r.test(f.nodeName));for(const{nodeName:f,nodeValue:i}of C){const g=r.exec(f)[1];switch(!0){case/^on+/.test(i):{const m=i.slice(2).toLowerCase();l.removeEventListener(m,n[g]),l.addEventListener(m,n[g]);break}case/ref/.test(i):{const m=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:l,fn:n[g]});h.push(m);break}case/^data-+/.test(i):case/^aria-+/.test(i):{i==="data-input"?V(l,n[g],Symbol("input")):l.setAttribute(i,v(n[g]));break}case/class/.test(i):{n[g]?l.classList.add(...n[g].split(" ")):l.setAttribute("class","");break}case/value/.test(i):{l.nodeName.toLowerCase()==="select"?P(l,n[g]):l.value=v(n[g]);break}case/disabled/.test(i):case/checked/.test(i):{n[g]?l.setAttribute(i,n[g]):l.removeAttribute(i);break}default:l.setAttribute(i,v(n[g]))}l.removeAttribute(f)}}l=d.nextNode()}},T=(a,n)=>{const d=document.createTreeWalker(a,NodeFilter.SHOW_COMMENT,null);let l=d.nextNode(),C;for(;l;){if(C=u.exec(l.data)){const f=Array.isArray(n[C[1]])?n[C[1]]:[n[C[1]]];l.replaceWith(...f),d.currentNode=a}l=d.nextNode()}},R=(a,n)=>{if(!a||!n||a.nodeType!==1||n.nodeType!==1)return;const d=a.attributes,l=n.attributes,C=n.getAttribute("data-preserve-attributes"),f=C&&C==="true";for(const{name:i,value:g}of d)(!l[i]||l[i]!==g)&&n.setAttribute(i,g);if(!f)for(const{name:i}of l)d[i]||n.removeAttribute(i);if(n.tagName.toLowerCase()==="input"&&(n.value=a.value),n.tagName.indexOf("-")>-1&&a.tagName.indexOf("-")>-1){const i=Object.getOwnPropertySymbols(a),g=Object.getOwnPropertySymbols(n),m=i.length?a[i[0]]:"",O=g.length?n[g[0]]:"";m&&O&&m!==O&&V(n,JSON.parse(m),g[0])}},A=a=>a.nodeType===3?"text":a.nodeType===8?"comment":a.tagName.toLowerCase(),L=a=>a.childNodes&&a.childNodes.length>0?null:a.textContent,F=(a,n,d)=>{const l=n?Array.from(n.childNodes):[],C=a?Array.from(a.childNodes):[];let f=l.length-C.length;if(f>0)for(;f>0;f--)l[l.length-f].parentNode.removeChild(l[l.length-f]);C.forEach(function(i,g){const m=l[g];if(R(i,m),d&&m&&m.nodeType===1&&m.tagName.indexOf("-")>-1)return;if(!m){n&&n.appendChild(i);return}if(A(i)!==A(m)){m.replaceWith(i);return}const O=L(i);if(O&&O!==L(m)){m.textContent=O;return}if(m.childNodes.length>0&&i.childNodes.length<1){m.innerHTML="";return}if(m.childNodes.length<1&&i.childNodes.length>0){const D=document.createDocumentFragment();F(i,D,!1),m.appendChild(D);return}if(i.childNodes.length>0){F(i,m,!0);return}})};return{html:(a,...n)=>{let d="";const{length:l}=a;for(let f=1;f<l;f++){const i=n[f-1];let g=!1;if(d+=a[f-1],s.test(d)&&t.test(d)&&(d=d.replace(s,(m,O,D)=>`${e}${f-1}=${D||'"'}${O}${D?"":'"'}`),g=!0),!g)switch(!0){case Array.isArray(i):case i instanceof DocumentFragment:{d+=`<!--${o}${f-1}-->`;break}case(typeof i=="object"&&i!==null):{"html"in i&&(d+=i.html);break}default:d+=i||""}}d+=a[l-1];const C=k(d.trim());return w(C,n),T(C,n),C},render:(a,n)=>{a&&!a.children.length?(a.innerHTML="",a.appendChild(n)):F(n,a,!1),h.forEach(d=>{d()}),h=[],p.forEach(d=>{d()}),p=[]}}})();class z{constructor(t,e){y(this,"_shadowRoot");y(this,"_hostElement");y(this,"update");y(this,"emitEvent");this._hostElement=t,this._shadowRoot=e}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const St={selector:"",root:!1,styles:"",deps:[],standalone:!1,encapsulation:"shadowDom"},st=(s,t)=>{const e=document.createElement("style");return e.innerHTML=s,t&&t.appendChild(e),e},Ct=(s,t)=>{var e,r,o,u,h,ot,v,at,k;if(s={...St,...s},s.styles=s.styles.toString(),s.root&&!j.isRootNodeSet)j.isRootNodeSet=!0,s.styles&&(j.globalStyles.replace(s.styles),j.globalStyleTag=st(s.styles,document.head));else if(s.root&&j.isRootNodeSet)throw Error("Cannot register duplicate root component in "+s.selector+" component");window.customElements.define(s.selector,(k=class extends HTMLElement{constructor(){super();M(this,h);M(this,v);M(this,e,void 0);M(this,r,void 0);M(this,o,void 0);y(this,"renderCount",0);M(this,u,new q);if(pt)H(this,r,this.attachShadow({mode:"open"})),_(this,r).adoptedStyleSheets=j.getComputedCss(s.styles,s.standalone);else{H(this,r,this);const w=s.styles.replaceAll(":host",s.selector);H(this,o,st(w,document.head))}Q(this,h,ot).call(this),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this)}static get observedAttributes(){return t.observedAttributes||[]}update(){const w=_(this,e).render();typeof w=="string"?_(this,r).innerHTML=yt(w):et(_(this,r),w)}setProps(w){var T,R;for(const[A,L]of Object.entries(w))t.observedProperties.find(F=>F===A)&&(_(this,e)[A]=L);(R=(T=_(this,e)).onPropertiesChanged)==null||R.call(T)}getInstance(){return _(this,e)}connectedCallback(){var w,T;_(this,u).add(B(this,"bindprops",R=>{const A=R.detail.props;A&&this.setProps(A)})),_(this,u).add(B(this,"refresh_component",()=>{var R,A;(A=(R=_(this,e)).mount)==null||A.call(R)})),_(this,e).beforeMount&&_(this,u).add(ht(this.update,_(this,e).beforeMount.bind(_(this,e)))),this.update(),(T=(w=_(this,e)).mount)==null||T.call(w)}attributeChangedCallback(w,T,R){var A,L;(L=(A=_(this,e)).onAttributesChanged)==null||L.call(A,w,T,R)}disconnectedCallback(){var w,T,R;this.renderCount=1,(T=(w=_(this,e)).unmount)==null||T.call(w),(R=_(this,o))==null||R.remove(),_(this,u).unsubscribe()}},e=new WeakMap,r=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakSet,ot=function(){const w=new z(this,_(this,r));w.update=()=>{this.update()},w.emitEvent=(T,R)=>{Q(this,v,at).call(this,T,R)},H(this,e,tt(vt(this,t),s.deps,w))},v=new WeakSet,at=function(w,T){const R=new CustomEvent(w,{detail:T});this.dispatchEvent(R)},k))},Rt={deps:[]},rt=s=>t=>{if(s.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(s.selector)||Ct(s,t)},Y=(s={})=>t=>{if(s={...Rt,...s},t.prototype.__metadata__={name:"SERVICE"},s.deps.some(r=>r.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const e=tt(t,s.deps);X.register(t,e)},Et=s=>{let t;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?t=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:t=s.value;break}case"select":{const e=s.type==="select-one",o=[...Array.from(s.options)].filter(u=>u.selected).map(u=>u.value??(u.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));t=e?o[0]:o;break}default:{t=s.value;break}}return t};class Tt{constructor(t){y(this,"_initialValues");y(this,"_controls",Object.create(null));y(this,"_errors",new Map);this._initialValues=t;for(const[e,r]of Object.entries(t)){const o=[...Array.isArray(r)?r:[r]];this._controls[e]={value:o[0],validators:o.length>1?o[1]:[]}}this.changeHandler=this.changeHandler.bind(this),this.getControl=this.getControl.bind(this),this.reset=this.reset.bind(this)}get errors(){return this._checkValidity(),this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const t={};for(const[e,r]of Object.entries(this._controls))t[e]=r.value;return t}getControl(t){return this._controls[t]}changeHandler(t){return e=>{const r=Et(e.target);this.getControl(t).value=r,this._isTouched=!0}}reset(){for(const[t,e]of Object.entries(this._initialValues)){const r=[...Array.isArray(e)?e:[e]];this._controls[t].value=JSON.parse(JSON.stringify(r))[0]}this._errors.clear(),this._isTouched=!1}_checkValidity(){this._errors.clear(),this._isTouched=!0;for(const t in this._controls){const e=this._controls[t].value,r=this._controls[t].validators;this._controls[t].errors=null;for(const o of r){const u=o(e);u!==null&&(this._errors.has(t)?(this._errors.set(t,{...this._errors.get(t),...u}),this._controls[t].errors={...this._controls[t].errors,...u}):(this._errors.set(t,u),this._controls[t].errors=u))}}}}class At{static required(t){return t.length?null:{required:!0}}static min(t){return e=>e.length>=t?null:{minLength:{requiredLength:t}}}static max(t){return e=>e.length<=t?null:{maxLength:{requiredLength:t}}}static pattern(t){return e=>new RegExp(t).test(e)?null:{pattern:!0}}}const I=class{static checkParams(t,e){let r=0;const o={},u=e.paramCount;for(let h=0;h<t.length;h++){const p=e.params[h];p.indexOf(":")>=0&&(o[p.split(":")[1]]=t[h].split("?")[0],r+=1)}return r===u?o:{}}static getParamCount(t){let e=0;return t.forEach(r=>{r.indexOf(":")>=0&&(e+=1)}),e}static formatRoute(t){const e={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:t.preload,canActivate:()=>!0};if(e.params=t.path.split("/").filter(r=>r.length>0),e.url=t.path,e.template="",e.redirectTo=t.redirectTo,t.template){if(!t.templatePath)throw Error("templatePath is required in route if template is mentioned.");e.template=t.template,e.templatePath=t.templatePath}t.canActivate&&(e.canActivate=t.canActivate),e.paramCount=I.getParamCount(e.params),I.routeList.push(e)}static preloadRoutes(){for(const t of I.routeList)t.templatePath&&t.templatePath()}static preloadSelectedRoutes(){const t=I.routeList.filter(e=>e.preload===!0);for(const e of t)e.templatePath&&e.templatePath()}};let E=I;y(E,"routeList",[]),y(E,"isHistoryBasedRouting",!0);function Pt(s,t){return s?new RegExp(s.replace(/:[^\s/]+/g,"(.+)")).test(t):!1}class G{constructor(){y(this,"_currentRoute",new $({path:"",routeParams:new Map,queryParams:new Map,state:{}}));y(this,"_template",new $(""));y(this,"_navigationEndEvent",new W);y(this,"_routeStateMap",new Map)}listenRouteChanges(){const t=E.isHistoryBasedRouting?"popstate":"hashchange";return E.isHistoryBasedRouting&&(window.history.replaceState({},null,""),function(e,r){var o=e.pushState;e.pushState=function(...u){o.apply(e,u),r()}}(window.history,this._registerOnHashChange.bind(this))),B(window,t,()=>{this._registerOnHashChange()})}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute.asObservable()}navigateTo(t="/",e){let r=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");r=r||"/",this._routeStateMap.clear(),this._routeStateMap.set(t,e),r===t?this._navigateTo(t,e):E.isHistoryBasedRouting?window.history.pushState(e,"",t):window.location.hash="#"+t}onNavigationEnd(){return this._navigationEndEvent.asObservable()}_registerOnHashChange(){const t=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,""),e=this._routeStateMap.get(t);this._navigateTo(t,e)}_navigateTo(t,e){const r={},o=t.split("/").filter(p=>p.length>0),u=E.routeList.filter(p=>{if(p.params.length===o.length&&Pt(p.url,t))return p;if(p.url===t)return p}),h=u.length>0?u[0]:null;h&&(r.path=t,r.state={...e||{}},J(h.canActivate()).subscribe(p=>{if(!p)return;const v=E.checkParams(o,h);if(Object.keys(v).length>0||t){r.routeParams=new Map(Object.entries(v));let P=[];E.isHistoryBasedRouting?P=new URLSearchParams(window.location.search).entries():P=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[],r.queryParams=new Map(P);const k=V=>{V.isRegistered=!0,this._currentRoute.next(r),this._template.next(V.template),this._navigationEndEvent.next()};h.isRegistered?k(h):h.templatePath?J(h.templatePath()).subscribe(()=>{k(h)}):h.redirectTo&&this.navigateTo(h.redirectTo,e)}else this.navigateTo(h.redirectTo,e)}))}}Y()(G);const Nt=()=>{class s{constructor(e,r){y(this,"_template","");y(this,"_subscriptions",new q)}beforeMount(){this._subscriptions.add(this.internalRouterSrvc.getTemplate().subscribe(e=>{this._template!==e&&(this._template=e)})),this._subscriptions.add(this.internalRouterSrvc.listenRouteChanges())}mount(){const e=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(e||"/")}unmount(){this._subscriptions.unsubscribe()}render(){if(this._template){const e=[`${this._template}`];return e.raw=[`${this._template}`],U(e)}else return U``}}rt({selector:"router-outlet",deps:[G,z]})(s)};class nt{constructor(t){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(t,e){this.internalRouter.navigateTo(t,e)}onNavigationEnd(){return this.internalRouter.onNavigationEnd()}registerRoutes(t,e=!1,r=!1){if(r&&(E.isHistoryBasedRouting=!r),Array.isArray(t)){for(const o of t)E.formatRoute(o);e?E.preloadRoutes():E.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}Y({deps:[G]})(nt),c.BehaviourSubjectObs=$,c.Component=rt,c.FormBuilder=Tt,c.Injectable=Y,c.Renderer=z,c.Router=nt,c.SubjectObs=W,c.Subscriptions=q,c.Validators=At,c.fromEvent=B,c.html=U,c.promisify=wt,c.registerRouterComponent=Nt,c.render=et,c.signal=ut,c.wrapIntoObservable=J,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
