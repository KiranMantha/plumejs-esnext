var Nt=Object.defineProperty;var kt=(l,g,S)=>g in l?Nt(l,g,{enumerable:!0,configurable:!0,writable:!0,value:S}):l[g]=S;var _=(l,g,S)=>(kt(l,typeof g!="symbol"?g+"":g,S),S),K=(l,g,S)=>{if(!g.has(l))throw TypeError("Cannot "+S)};var v=(l,g,S)=>(K(l,g,"read from private field"),S?S.call(l):g.get(l)),M=(l,g,S)=>{if(g.has(l))throw TypeError("Cannot add the same private member more than once");g instanceof WeakSet?g.add(l):g.set(l,S)},H=(l,g,S,N)=>(K(l,g,"write to private field"),N?N.call(l,S):g.set(l,S),S);var Q=(l,g,S)=>(K(l,g,"access private method"),S);(function(l,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(l=typeof globalThis<"u"?globalThis:l||self,g(l.PlumeJS={}))})(this,function(l){var O,it;"use strict";const g=s=>typeof s=="function",S=Object.create(null);let N=null;const ct=(s=>{function t(){return Math.random().toString(36).substring(2)}function e(i,o){const d=N;let b;N=t(),S[N]=i;try{o()}finally{b=N,N=d}return b}function r(i){const o=S[N];let d=i;function b(){return d}return b.set=function(T){g(T)?d=T(d):d=T,queueMicrotask(()=>{o()})},b}function u(i,o){const d=e(i,o);return function(){delete S[d]}}return s.augmentor=u,s.signal=r,s})({}),{augmentor:lt,signal:ut}=ct,X=new(it=class{constructor(){M(this,O,void 0);H(this,O,new WeakMap)}register(s,t){if(!v(this,O).get(s))v(this,O).set(s,t);else throw console.error(s),"service already exists"}getService(s){const t=v(this,O).get(s);if(t)return t;throw console.error(s),"service is not a registered service."}clear(){H(this,O,new WeakMap)}},O=new WeakMap,it),ht=s=>!!s&&typeof s.subscribe=="function",dt=s=>!!s&&typeof s.then=="function",Z=s=>{const t=s.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return t.length===3?t[1].split(",").map(e=>e.trim()):[]},ft=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),pt=s=>({subscribe:t=>{t(s)}}),bt=s=>({subscribe:t=>{Promise.resolve(s).then(e=>{t(e)})}}),gt=()=>Math.random().toString(36).substring(2);class W{constructor(){_(this,"_callbackCollection",{})}unsubscribe(t){delete this._callbackCollection[t]}asObservable(){return{subscribe:t=>this.subscribe(t)}}subscribe(t){const e=gt();return this._callbackCollection[e]=t,()=>this.unsubscribe(e)}next(t){for(const e in this._callbackCollection)this._callbackCollection[e](t)}}class q extends W{constructor(e){super();_(this,"_initialValue");this._initialValue=e}subscribe(e){const r=super.subscribe(e);return super.next(this._initialValue),r}next(e){this._initialValue=e,super.next(e)}}class ${constructor(){_(this,"_subcribers",[])}add(t){this._subcribers.push(t)}unsubscribe(){for(const t of this._subcribers)t();this._subcribers=[]}}const J=s=>ht(s)?s:dt(s)?bt(Promise.resolve(s)):pt(s),B=(s,t,e,r=!1)=>(s.addEventListener(t,e,r),()=>{s.removeEventListener(t,e,r)}),mt=s=>{const t=()=>new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),e=d=>{const b=d.querySelectorAll("script");for(const T of b)T.remove()},r=(d,b)=>{if(b=b.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(d)&&(b.includes("javascript:")||b.includes("data:"))||d.startsWith("on"))return!0},u=d=>{const b=d.attributes;for(const{name:T,value:k}of b)r(T,k)&&d.removeAttribute(T)},i=d=>{const b=d.children;for(const T of b)u(T),i(T)},o=t();return e(o),i(o),o.innerHTML},yt=function(s){s.renderCount===1&&queueMicrotask(()=>{s.update(),s.renderCount=0})},_t=(s,t)=>{const e=Z(t),r=()=>({get(u,i){const o=Object.prototype.toString.call(u[i]);return["[object Object]","[object Array]"].indexOf(o)>-1&&!("__metadata__"in u[i])?new Proxy(u[i],r()):u[i]},set(u,i,o){return u[i]=o,++s.renderCount,yt(s),!0}});return class extends t{constructor(...u){return super(...u),u.forEach((i,o)=>{e[o]&&e[o]!=="undefined"&&(this[e[o]]=i)}),new Proxy(this,r())}}},vt=()=>{let s;return[new Promise(e=>{s=e}),s]},tt=(s,t,e)=>{if(t.length>0){const r=[];for(const o of t)o.prototype.__metadata__.name!=="RENDERER"?r.push(X.getService(o)):r.push(e);const u=Z(s),i=new s(...r);return t.forEach((o,d)=>{i[u[d]]=r[d]}),i}else return new s},j=new class{constructor(){_(this,"globalStyles");_(this,"globalStyleTag");_(this,"style_registry");_(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let t=[];const e=new CSSStyleSheet;if(e.insertRule(":host { display: block; }"),t=[this.globalStyles,e],s){const r=new CSSStyleSheet;r.replace(s),t.push(r)}return t}},{html:U,render:et}=(()=>{const s=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,t=/<[a-z][^>]+$/i,e="attr",r=/^attr([^ ]+)/,u="insertNode",i=/^insertNode([^ ]+)/;let o=[],d=[];const b=c=>{const n={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let f=JSON.stringify(c);const h=p=>n[p]||p;return f=(p=>p.replace(/[&<>\(\)]/g,h))(f),JSON.parse(f)},T=(c,n)=>{const f=c.options,h=Array.isArray(n)?n:[n];let C,p,a=f.length;for(;a--;){p=f[a];const m=p.getAttribute("value")??(p.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(p.selected=h.indexOf(m)>-1)&&(C=!0)}C||(c.selectedIndex=-1)},k=c=>{const n=document.createElement("template");return n.innerHTML=c,n.content},V=(c,n,f)=>{const h=()=>{setTimeout(()=>{if(c.isConnected){const C=new CustomEvent("bindprops",{detail:{props:n},bubbles:!1});c.dispatchEvent(C)}})};c[f]=JSON.stringify(n),d.push(h)},w=(c,n)=>{const f=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null);let h=f.nextNode();for(;h;){if(h.hasAttributes()){const C=Array.from(h.attributes).filter(p=>r.test(p.nodeName));for(const{nodeName:p,nodeValue:a}of C){const m=r.exec(p)[1];switch(!0){case/^on+/.test(a):{const y=a.slice(2).toLowerCase();h.removeEventListener(y,n[m]),h.addEventListener(y,n[m]);break}case/ref/.test(a):{const y=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:h,fn:n[m]});o.push(y);break}case/^data-+/.test(a):case/^aria-+/.test(a):{a==="data-input"?V(h,n[m],Symbol("input")):h.setAttribute(a,b(n[m]));break}case/class/.test(a):{n[m]?h.classList.add(...n[m].split(" ")):h.setAttribute("class","");break}case/value/.test(a):{h.nodeName.toLowerCase()==="select"?T(h,n[m]):h.value=b(n[m]);break}case/disabled/.test(a):case/checked/.test(a):{n[m]?h.setAttribute(a,n[m]):h.removeAttribute(a);break}default:h.setAttribute(a,b(n[m]))}h.removeAttribute(p)}}h=f.nextNode()}},A=(c,n)=>{const f=document.createTreeWalker(c,NodeFilter.SHOW_COMMENT,null);let h=f.nextNode(),C;for(;h;){if(C=i.exec(h.data)){const p=Array.isArray(n[C[1]])?n[C[1]]:[n[C[1]]];h.replaceWith(...p),f.currentNode=c}h=f.nextNode()}},R=(c,n)=>{if(!c||!n||c.nodeType!==1||n.nodeType!==1)return;const f=c.attributes,h=n.attributes,C=n.getAttribute("data-preserve-attributes"),p=C&&C==="true";for(const{name:a,value:m}of f)(!h[a]||h[a]!==m)&&n.setAttribute(a,m);if(!p)for(const{name:a}of h)f[a]||n.removeAttribute(a);if(n.tagName.toLowerCase()==="input"&&(n.value=c.value),n.tagName.indexOf("-")>-1&&c.tagName.indexOf("-")>-1){const a=Object.getOwnPropertySymbols(c),m=Object.getOwnPropertySymbols(n),y=a.length?c[a[0]]:"",x=m.length?n[m[0]]:"";y&&x&&y!==x&&V(n,JSON.parse(y),m[0])}},P=c=>c.nodeType===3?"text":c.nodeType===8?"comment":c.tagName.toLowerCase(),L=c=>c.childNodes&&c.childNodes.length>0?null:c.textContent,F=(c,n,f)=>{const h=n?Array.from(n.childNodes):[],C=c?Array.from(c.childNodes):[];let p=h.length-C.length;if(p>0)for(;p>0;p--)h[h.length-p].parentNode.removeChild(h[h.length-p]);C.forEach(function(a,m){const y=h[m];if(R(a,y),f&&y&&y.nodeType===1&&y.tagName.indexOf("-")>-1)return;if(!y){n&&n.appendChild(a);return}if(P(a)!==P(y)){y.replaceWith(a);return}const x=L(a);if(x&&x!==L(y)){y.textContent=x;return}if(y.childNodes.length>0&&a.childNodes.length<1){y.innerHTML="";return}if(y.childNodes.length<1&&a.childNodes.length>0){const D=document.createDocumentFragment();F(a,D,!1),y.appendChild(D);return}if(a.childNodes.length>0){F(a,y,!0);return}})};return{html:(c,...n)=>{let f="";const{length:h}=c;for(let p=1;p<h;p++){const a=n[p-1];let m=!1;if(f+=c[p-1],s.test(f)&&t.test(f)&&(f=f.replace(s,(y,x,D)=>`${e}${p-1}=${D||'"'}${x}${D?"":'"'}`),m=!0),!m)switch(!0){case Array.isArray(a):case a instanceof DocumentFragment:{f+=`<!--${u}${p-1}-->`;break}case(typeof a=="object"&&a!==null):{"html"in a&&(f+=a.html);break}default:f+=a||""}}f+=c[h-1];const C=k(f.trim());return w(C,n),A(C,n),C},render:(c,n)=>{c&&!c.children.length?(c.innerHTML="",c.appendChild(n)):F(n,c,!1),o.forEach(f=>{f()}),o=[],d.forEach(f=>{f()}),d=[]}}})();class z{constructor(t,e){_(this,"_shadowRoot");_(this,"_hostElement");_(this,"update");_(this,"emitEvent");this._hostElement=t,this._shadowRoot=e}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const wt={selector:"",root:!1,styles:"",deps:[],standalone:!1,encapsulation:"shadowDom"},st=(s,t)=>{const e=document.createElement("style");return e.innerHTML=s,t&&t.appendChild(e),e},St=(s,t)=>{var e,r,u,i,o,ot,b,at,k;if(s={...wt,...s},s.styles=s.styles.toString(),s.root&&!j.isRootNodeSet)j.isRootNodeSet=!0,s.styles&&(j.globalStyles.replace(s.styles),j.globalStyleTag=st(s.styles,document.head));else if(s.root&&j.isRootNodeSet)throw Error("Cannot register duplicate root component in "+s.selector+" component");window.customElements.define(s.selector,(k=class extends HTMLElement{constructor(){super();M(this,o);M(this,b);M(this,e,void 0);M(this,r,void 0);M(this,u,void 0);_(this,"renderCount",0);M(this,i,new $);if(ft)H(this,r,this.attachShadow({mode:"open"})),v(this,r).adoptedStyleSheets=j.getComputedCss(s.styles,s.standalone);else{H(this,r,this);const w=s.styles.replaceAll(":host",s.selector);H(this,u,st(w,document.head))}Q(this,o,ot).call(this),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this)}static get observedAttributes(){return t.observedAttributes||[]}update(){const w=v(this,e).render();typeof w=="string"?v(this,r).innerHTML=mt(w):et(v(this,r),w)}setProps(w){var A,R;for(const[P,L]of Object.entries(w))t.observedProperties.find(F=>F===P)&&(v(this,e)[P]=L);(R=(A=v(this,e)).onPropertiesChanged)==null||R.call(A)}getInstance(){return v(this,e)}connectedCallback(){var w,A;v(this,i).add(B(this,"bindprops",R=>{const P=R.detail.props;P&&this.setProps(P)})),v(this,i).add(B(this,"refresh_component",()=>{var R,P;(P=(R=v(this,e)).mount)==null||P.call(R)})),v(this,e).beforeMount&&v(this,i).add(lt(this.update,v(this,e).beforeMount.bind(v(this,e)))),this.update(),(A=(w=v(this,e)).mount)==null||A.call(w)}attributeChangedCallback(w,A,R){var P,L;(L=(P=v(this,e)).onAttributesChanged)==null||L.call(P,w,A,R)}disconnectedCallback(){var w,A,R;this.renderCount=1,(A=(w=v(this,e)).unmount)==null||A.call(w),(R=v(this,u))==null||R.remove(),v(this,i).unsubscribe()}},e=new WeakMap,r=new WeakMap,u=new WeakMap,i=new WeakMap,o=new WeakSet,ot=function(){const w=new z(this,v(this,r));w.update=()=>{this.update()},w.emitEvent=(A,R)=>{Q(this,b,at).call(this,A,R)},H(this,e,tt(_t(this,t),s.deps,w))},b=new WeakSet,at=function(w,A){const R=new CustomEvent(w,{detail:A});this.dispatchEvent(R)},k))},Ct={deps:[]},rt=s=>t=>{if(s.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(s.selector)||St(s,t)},Y=(s={})=>t=>{if(s={...Ct,...s},t.prototype.__metadata__={name:"SERVICE"},s.deps.some(r=>r.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const e=tt(t,s.deps);X.register(t,e)},Rt=s=>{let t;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?t=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:t=s.value;break}case"select":{const e=s.type==="select-one",u=[...Array.from(s.options)].filter(i=>i.selected).map(i=>i.value??(i.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));t=e?u[0]:u;break}default:{t=s.value;break}}return t};class Et{constructor(t){_(this,"_initialValues");_(this,"_controls",Object.create(null));_(this,"_errors",new Map);this._initialValues=t;for(const[e,r]of Object.entries(t)){const u=[...Array.isArray(r)?r:[r]];this._controls[e]={value:u[0],validators:u.length>1?u[1]:[]}}this.changeHandler=this.changeHandler.bind(this),this.getControl=this.getControl.bind(this),this.reset=this.reset.bind(this)}get errors(){return this._checkValidity(),this._errors}get valid(){return this._checkValidity(),!this._errors.size}get value(){const t={};for(const[e,r]of Object.entries(this._controls))t[e]=r.value;return t}getControl(t){return this._controls[t]}changeHandler(t){return e=>{const r=Rt(e.target);this.getControl(t).value=r,this._isTouched=!0}}reset(){for(const[t,e]of Object.entries(this._initialValues)){const r=[...Array.isArray(e)?e:[e]];this._controls[t].value=JSON.parse(JSON.stringify(r))[0]}this._errors.clear(),this._isTouched=!1}_checkValidity(){this._errors.clear(),this._isTouched=!0;for(const t in this._controls){const e=this._controls[t].value,r=this._controls[t].validators;this._controls[t].errors=null;for(const u of r){const i=u(e);i!==null&&(this._errors.has(t)?(this._errors.set(t,{...this._errors.get(t),...i}),this._controls[t].errors={...this._controls[t].errors,...i}):(this._errors.set(t,i),this._controls[t].errors=i))}}}}class Tt{static required(t){return t.length?null:{required:!0}}static min(t){return e=>e.length>=t?null:{minLength:{requiredLength:t}}}static max(t){return e=>e.length<=t?null:{maxLength:{requiredLength:t}}}static pattern(t){return e=>new RegExp(t).test(e)?null:{pattern:!0}}}const I=class{static checkParams(t,e){let r=0;const u={},i=e.paramCount;for(let o=0;o<t.length;o++){const d=e.params[o];d.indexOf(":")>=0&&(u[d.split(":")[1]]=t[o].split("?")[0],r+=1)}return r===i?u:{}}static getParamCount(t){let e=0;return t.forEach(r=>{r.indexOf(":")>=0&&(e+=1)}),e}static formatRoute(t){const e={params:{},url:"",template:"",paramCount:0,isRegistered:!1,redirectTo:"",preload:t.preload,canActivate:()=>!0};if(e.params=t.path.split("/").filter(r=>r.length>0),e.url=t.path,e.template="",e.redirectTo=t.redirectTo,t.template){if(!t.templatePath)throw Error("templatePath is required in route if template is mentioned.");e.template=t.template,e.templatePath=t.templatePath}t.canActivate&&(e.canActivate=t.canActivate),e.paramCount=I.getParamCount(e.params),I.routeList.push(e)}static preloadRoutes(){for(const t of I.routeList)t.templatePath&&t.templatePath()}static preloadSelectedRoutes(){const t=I.routeList.filter(e=>e.preload===!0);for(const e of t)e.templatePath&&e.templatePath()}};let E=I;_(E,"routeList",[]),_(E,"isHistoryBasedRouting",!0);function At(s,t){return s?new RegExp(s.replace(/:[^\s/]+/g,"(.+)")).test(t):!1}class G{constructor(){_(this,"_currentRoute",new q({path:"",routeParams:new Map,queryParams:new Map,state:{}}));_(this,"_template",new q(""));_(this,"_navigationEndEvent",new W);_(this,"_routeStateMap",new Map)}listenRouteChanges(){const t=E.isHistoryBasedRouting?"popstate":"hashchange";return E.isHistoryBasedRouting&&(window.history.replaceState({},null,""),function(e,r){var u=e.pushState;e.pushState=function(...i){u.apply(e,i),r()}}(window.history,this._registerOnHashChange.bind(this))),B(window,t,()=>{this._registerOnHashChange()})}getTemplate(){return this._template.asObservable()}getCurrentRoute(){return this._currentRoute.asObservable()}navigateTo(t="/",e){let r=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");r=r||"/",this._routeStateMap.clear(),this._routeStateMap.set(t,e),r===t?this._navigateTo(t,e):E.isHistoryBasedRouting?window.history.pushState(e,"",t):window.location.hash="#"+t}onNavigationEnd(){return this._navigationEndEvent.asObservable()}_registerOnHashChange(){const t=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,""),e=this._routeStateMap.get(t);this._navigateTo(t,e)}_navigateTo(t,e){const r={},u=t.split("/").filter(d=>d.length>0),i=E.routeList.filter(d=>{if(d.params.length===u.length&&At(d.url,t))return d;if(d.url===t)return d}),o=i.length>0?i[0]:null;o&&(r.path=t,r.state={...e||{}},J(o.canActivate()).subscribe(d=>{if(!d)return;const b=E.checkParams(u,o);if(Object.keys(b).length>0||t){r.routeParams=new Map(Object.entries(b));let T=[];E.isHistoryBasedRouting?T=new URLSearchParams(window.location.search).entries():T=window.location.hash.split("?")[1]?new URLSearchParams(window.location.hash.split("?")[1]).entries():[],r.queryParams=new Map(T);const k=V=>{V.isRegistered=!0,this._currentRoute.next(r),this._template.next(V.template),this._navigationEndEvent.next()};o.isRegistered?k(o):o.templatePath?J(o.templatePath()).subscribe(()=>{k(o)}):o.redirectTo&&this.navigateTo(o.redirectTo,e)}else this.navigateTo(o.redirectTo,e)}))}}Y()(G);const Pt=()=>{class s{constructor(e,r){_(this,"_template","");_(this,"_subscriptions",new $)}beforeMount(){this._subscriptions.add(this.internalRouterSrvc.getTemplate().subscribe(e=>{this._template!==e&&(this._template=e)})),this._subscriptions.add(this.internalRouterSrvc.listenRouteChanges())}mount(){const e=E.isHistoryBasedRouting?window.location.pathname:window.location.hash.replace(/^#/,"");this.internalRouterSrvc.navigateTo(e||"/")}unmount(){this._subscriptions.unsubscribe()}render(){if(this._template){const e=[`${this._template}`];return e.raw=[`${this._template}`],U(e)}else return U``}}rt({selector:"router-outlet",deps:[G,z]})(s)};class nt{constructor(t){}getCurrentRoute(){return this.internalRouter.getCurrentRoute()}navigateTo(t,e){this.internalRouter.navigateTo(t,e)}onNavigationEnd(){return this.internalRouter.onNavigationEnd()}registerRoutes(t,e=!1,r=!1){if(r&&(E.isHistoryBasedRouting=!r),Array.isArray(t)){for(const u of t)E.formatRoute(u);e?E.preloadRoutes():E.preloadSelectedRoutes()}else throw Error("router.addRoutes: the parameter must be an array")}}Y({deps:[G]})(nt),l.BehaviourSubjectObs=q,l.Component=rt,l.FormBuilder=Et,l.Injectable=Y,l.Renderer=z,l.Router=nt,l.SubjectObs=W,l.Subscriptions=$,l.Validators=Tt,l.fromEvent=B,l.html=U,l.promisify=vt,l.registerRouterComponent=Pt,l.render=et,l.signal=ut,l.wrapIntoObservable=J,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
