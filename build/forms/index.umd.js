(function(i,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(i=typeof globalThis<"u"?globalThis:i||self,l(i.plumejs_forms={}))})(this,function(i){"use strict";var b=Object.defineProperty;var C=(i,l,u)=>l in i?b(i,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[l]=u;var o=(i,l,u)=>(C(i,typeof l!="symbol"?l+"":l,u),u);(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})();const l=s=>typeof s=="function",u=Object.create(null);let f=null;function c(s){const e=u[f];let t=s;function r(){return t}return r.set=function(n){l(n)?t=n(t):t=n;try{e()}catch{}},r}new class{constructor(){o(this,"globalStyles");o(this,"globalStyleTag");o(this,"style_registry");o(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(s=""){let e=[];const t=new CSSStyleSheet;if(t.insertRule(":host { display: block; }"),e=[this.globalStyles,t],s){const r=new CSSStyleSheet;r.replace(s),e.push(r)}return e}};const h=s=>typeof s=="function",g=(s,e)=>s.nodeName&&s.nodeName.toLowerCase()===e.toLowerCase(),v=s=>{let e;switch(s.nodeName&&s.nodeName.toLowerCase()){case"input":case"textarea":{["radio","checkbox"].includes(s.type)?e=s.checked?s.value!==null&&s.value!=="on"?s.value:!0:!1:e=s.value;break}case"select":{const t=s.type==="select-one",n=[...Array.from(s.options).filter(a=>!a.disabled&&(!a.parentNode.disabled||!g(a.parentNode,"optgroup")))].filter(a=>a.selected).map(a=>a.value??(a.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" "));e=t?n[0]:n;break}default:{e=s.value;break}}return e};class d{constructor(e,t,r){o(this,"name");o(this,"validators");o(this,"isTouched",!1);o(this,"validity",null);o(this,"_initialValue");o(this,"_value");o(this,"_errorMessage",c(""));o(this,"_parent");const n=[...Array.isArray(t)?t:[t]];this.name=e,this._initialValue=n[0],this._value=n[0],this.validators=n.length>1?n[1]:[],this._parent=r}get value(){return this._value}get errorMessage(){return this._errorMessage()}register(){return{attrs:{name:this.name,value:this.value,onchange:e=>{this._value=v(e.target)},onblur:()=>{this.isTouched=!0,this.validate()}}}}validate(){var t;let e="";for(const r of this.validators)if(this.validity=h(r)?r(this.value):r.rule(this.value),this.validity!==null){e=h(r)?"error":r.message,(t=this._parent)==null||t.setError(this.name,this.validity);break}this._errorMessage.set(e)}reset(){this._value=this._initialValue,this.isTouched=!1,this.validity=null,this._errorMessage.set("")}}const y=()=>Math.random().toString(36).substring(2);class _{constructor(e){o(this,"_controls",c([]));o(this,"_initialCollection",[]);o(this,"validity",null);this._initialCollection=e;const t=this._generateControls(e);this._controls.set(t)}get value(){return this.controls.map(t=>{const r={};for(const n of t)r[n.name]=n.control.value;return r})}get controls(){return this._controls()}validate(){const e=this.controls.flatMap(t=>{const r=t.filter(({control:n})=>{if(n.validate(),n.errorMessage)return n.errorMessage});if(r.length)return r}).filter(Boolean);this.validity=e.length?{invalid:!0}:null}append(e){this._controls.set(t=>[...t,this._generateItemControls(e)])}remove(e){const t=[...this.controls];t.splice(e,1),this._controls.set(t)}reset(){const e=this._generateControls(this._initialCollection);this.validity=null,this._controls.set(e)}_generateControls(e){return e.map(t=>this._generateItemControls(t))}_generateItemControls(e){const t=[],r=y();for(const[n,a]of Object.entries(e)){const S={name:n,control:new d(`${n}-${r}`,a),indexedName:`${n}-${r}`};t.push(S)}return t}}class m{constructor(e){o(this,"_initialValues");o(this,"_controls",new Map);o(this,"_errors",new Map);o(this,"_errorCount",0);o(this,"_isSubmitted",!1);this._initialValues=e;for(const[t,r]of Object.entries(e))r instanceof _?this._controls.set(t,r):this._controls.set(t,new d(t,r,{setError:this._setError.bind(this)}))}get hasErrors(){return!!this._errorCount}get errors(){return this._errors}get valid(){return!this._errors.size}get value(){const e={};for(const[t,r]of this._controls)e[t]=r.value;return e}get submitted(){return this._isSubmitted}getControl(e){return this._controls.get(e)}register(e){return this.getControl(e).register()}handleSubmit(e,t){e.preventDefault(),this._isSubmitted=!0,this._checkValidity(),t(this.value)}reset(){this._controls.forEach(e=>{e.reset()}),this._isSubmitted=!1,this._errors.clear(),this._errorCount=0}_setError(e,t){t?this._errors.set(e,t):this._errors.delete(e),this._errorCount=this._errors.size}_checkValidity(){this._errors.clear();for(const[e]of this._controls)this._executeValidators(e);this._errorCount=this._errors.size}_executeValidators(e){const t=this.getControl(e);t.validate(),t.validity!==null?this._errors.set(e,{...this._errors.get(e)||{},...t.validity}):this._errors.delete(e)}}class p{static required(e){return e.length?null:{required:!0}}static min(e){return t=>t.length>=e?null:{minLength:{requiredLength:e}}}static max(e){return t=>t.length<=e?null:{maxLength:{requiredLength:e}}}static pattern(e){return t=>new RegExp(e).test(t)?null:{pattern:!0}}}i.FieldArray=_,i.FormBuilder=m,i.Validators=p,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
