var _e=Object.defineProperty;var Ee=(o,d,y)=>d in o?_e(o,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):o[d]=y;var A=(o,d,y)=>(Ee(o,typeof d!="symbol"?d+"":d,y),y),z=(o,d,y)=>{if(!d.has(o))throw TypeError("Cannot "+y)};var m=(o,d,y)=>(z(o,d,"read from private field"),y?y.call(o):d.get(o)),L=(o,d,y)=>{if(d.has(o))throw TypeError("Cannot add the same private member more than once");d instanceof WeakSet?d.add(o):d.set(o,y)},M=(o,d,y,F)=>(z(o,d,"write to private field"),F?F.call(o,y):d.set(o,y),y);var U=(o,d,y)=>(z(o,d,"access private method"),y);(function(o,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(o=typeof globalThis<"u"?globalThis:o||self,d(o.plumejs={}))})(this,function(o){var I,V;"use strict";const d=e=>!!e&&typeof e.subscribe=="function",y=e=>!!e&&typeof e.then=="function",F=e=>{const t=e.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return t.length===3?t[1].split(",").map(s=>s.trim()):[]},se=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),ne=e=>({subscribe:t=>{t(e)}}),re=e=>({subscribe:t=>{Promise.resolve(e).then(s=>{t(s)})}}),W=()=>Math.random().toString(36).substring(2);class q{constructor(){A(this,"_callbackCollection",{})}unsubscribe(t){delete this._callbackCollection[t]}asObservable(){return{subscribe:t=>this.subscribe(t)}}subscribe(t){const s=W();return this._callbackCollection[s]=t,()=>this.unsubscribe(s)}next(t){for(const s in this._callbackCollection)this._callbackCollection[s](t)}}class ie extends q{constructor(s){super();A(this,"_initialValue");this._initialValue=s}subscribe(s){const a=super.subscribe(s);return super.next(this._initialValue),a}next(s){this._initialValue=s,super.next(s)}}class B{constructor(){A(this,"_subcribers",[])}add(t){this._subcribers.push(t)}unsubscribe(){for(const t of this._subcribers)t();this._subcribers=[]}}const oe=e=>d(e)?e:y(e)?re(Promise.resolve(e)):ne(e),$=(e,t,s,a=!1)=>(e.addEventListener(t,s,a),()=>{e.removeEventListener(t,s,a)}),ce=e=>{const t=()=>new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),s=C=>{const S=C.querySelectorAll("script");for(const R of S)R.remove()},a=(C,S)=>{if(S=S.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(C)&&(S.includes("javascript:")||S.includes("data:"))||C.startsWith("on"))return!0},h=C=>{const S=C.attributes;for(const{name:R,value:D}of S)a(R,D)&&C.removeAttribute(R)},g=C=>{const S=C.children;for(const R of S)h(R),g(R)},p=t();return s(p),g(p),p.innerHTML},ae=(e,t)=>{const s=F(t),a=()=>({get(h,g){const p=Object.prototype.toString.call(h[g]);return["[object Object]","[object Array]"].indexOf(p)>-1&&!("__metadata__"in h[g])?new Proxy(h[g],a()):h[g]},set(h,g,p){return h[g]=p,e(),!0}});return class extends t{constructor(...h){return super(...h),h.forEach((g,p)=>{s[p]&&s[p]!=="undefined"&&(this[s[p]]=g)}),new Proxy(this,a())}}},le=()=>{let e;return[new Promise(s=>{e=s}),e]},ue=e=>typeof e=="function",Q=Object.create(null);let O=null;function de(e,t){const s=O;let a;O=W(),Q[O]=e;try{t()}finally{a=O,O=s}return a}function he(e){const t=Q[O];let s=e;function a(){return s}return a.set=function(h){ue(h)?s=h(s):s=h,t()},a}function fe(e,t){const s=de(e,t);return function(){delete Q[s]}}const Y=new(V=class{constructor(){L(this,I,void 0);M(this,I,new WeakMap)}register(e,t){if(!m(this,I).get(e))m(this,I).set(e,t);else throw console.error(e),"service already exists"}getService(e){const t=m(this,I).get(e);if(t)return t;throw console.error(e),"service is not a registered service."}clear(){M(this,I,new WeakMap)}},I=new WeakMap,V),G=(e,t,s)=>{if(t.length>0){const a=[];for(const p of t)p.prototype.__metadata__.name!=="RENDERER"?a.push(Y.getService(p)):a.push(s);const h=F(e),g=new e(...a);return t.forEach((p,C)=>{g[h[C]]=a[C]}),g}else return new e},j=new class{constructor(){A(this,"globalStyles");A(this,"globalStyleTag");A(this,"style_registry");A(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(e=""){let t=[];const s=new CSSStyleSheet;if(s.insertRule(":host { display: block; }"),t=[this.globalStyles,s],e){const a=new CSSStyleSheet;a.replace(e),t.push(a)}return t}},{html:be,render:K}=(()=>{const e=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,t=/<[a-z][^>]+$/i,s="attr",a=/^attr([^ ]+)/,h="insertNode",g=/^insertNode([^ ]+)/;let p=[],C=[];const S=n=>{const r={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let i=JSON.stringify(n);const c=l=>r[l]||l;return i=(l=>l.replace(/[&<>\(\)]/g,c))(i),JSON.parse(i)},R=(n,r)=>{const i=n.options,c=Array.isArray(r)?r:[r];let b,l,u=i.length;for(;u--;){l=i[u];const v=l.getAttribute("value")??(l.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(l.selected=c.indexOf(v)>-1)&&(b=!0)}b||(n.selectedIndex=-1)},D=n=>{const r=document.createElement("template");return r.innerHTML=n,r.content},H=(n,r,i)=>{const c=()=>{setTimeout(()=>{if(n.isConnected){const b=new CustomEvent("bindprops",{detail:{props:r},bubbles:!1});n.dispatchEvent(b)}})};n[i]=JSON.stringify(r),C.push(c)},f=(n,r,i)=>{switch(!0){case/attrs/.test(r):{const c=i.attrs;for(const b in c)f(n,b,c[b]);break}case/^on+/.test(r):{const c=r.slice(2).toLowerCase();n.removeEventListener(c,i),n.addEventListener(c,i);break}case/ref/.test(r):{const c=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:n,fn:i});p.push(c);break}case/^data-+/.test(r):case/^aria-+/.test(r):{r==="data-input"?H(n,i,Symbol("input")):n.setAttribute(r,S(i));break}case/class/.test(r):{i?n.classList.add(...i.split(" ")):n.setAttribute("class","");break}case/value/.test(r):{n.nodeName.toLowerCase()==="select"?R(n,i):n.value=S(i);break}case/disabled/.test(r):case/checked/.test(r):{i?n.setAttribute(r,i):n.removeAttribute(r);break}default:n.setAttribute(r,S(i))}},_=(n,r)=>{const i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,null);let c=i.nextNode();for(;c;){if(c.hasAttributes()){const b=Array.from(c.attributes).filter(l=>a.test(l.nodeName));for(const{nodeName:l,nodeValue:u}of b){const v=a.exec(l)[1];f(c,u,r[v]),c.removeAttribute(l)}}c=i.nextNode()}},w=(n,r)=>{const i=document.createTreeWalker(n,NodeFilter.SHOW_COMMENT,null);let c=i.nextNode(),b;for(;c;){if(b=g.exec(c.data)){const l=Array.isArray(r[b[1]])?r[b[1]]:[r[b[1]]];c.replaceWith(...l),i.currentNode=n}c=i.nextNode()}},T=(n,r)=>{if(!n||!r||n.nodeType!==1||r.nodeType!==1)return;const i=n.attributes,c=r.attributes,b=r.getAttribute("data-preserve-attributes"),l=b&&b==="true";for(const{name:u,value:v}of i)(!c[u]||c[u]!==v)&&r.setAttribute(u,v);if(!l)for(const{name:u}of c)i[u]||r.removeAttribute(u);if(["input","textarea"].includes(r.tagName.toLowerCase())&&(r.value=n.value),r.tagName.indexOf("-")>-1&&n.tagName.indexOf("-")>-1){const u=Object.getOwnPropertySymbols(n).find(k=>k.description==="input"),v=Object.getOwnPropertySymbols(r).find(k=>k.description==="input"),E=u?n[u]:"",P=v?r[v]:"";E&&P&&E!==P&&H(r,JSON.parse(E),v)}},x=n=>n.nodeType===3?"text":n.nodeType===8?"comment":n.tagName.toLowerCase(),N=n=>n.childNodes&&n.childNodes.length>0?null:n.textContent,J=(n,r,i)=>{const c=r?Array.from(r.childNodes):[],b=n?Array.from(n.childNodes):[];let l=c.length-b.length;if(l>0)for(;l>0;l--)c[c.length-l].parentNode.removeChild(c[c.length-l]);b.forEach(function(u,v){const E=c[v];if(T(u,E),i&&E&&E.nodeType===1&&E.tagName.indexOf("-")>-1)return;if(!E){r&&r.appendChild(u);return}if(x(u)!==x(E)){E.replaceWith(u);return}const P=N(u);if(P&&P!==N(E)){E.textContent=P;return}if(E.childNodes.length>0&&u.childNodes.length<1){E.innerHTML="";return}if(E.childNodes.length<1&&u.childNodes.length>0){const k=document.createDocumentFragment();J(u,k,!1),E.appendChild(k);return}if(u.childNodes.length>0){J(u,E,!0);return}})};return{html:(n,...r)=>{let i="";const{length:c}=n;for(let l=1;l<c;l++){const u=r[l-1];let v=!1;if(i+=n[l-1],e.test(i)&&t.test(i)&&(i=i.replace(e,(E,P,k)=>`${s}${l-1}=${k||'"'}${P}${k?"":'"'}`),v=!0),!v)switch(!0){case Array.isArray(u):case u instanceof DocumentFragment:{i+=`<!--${h}${l-1}-->`;break}case(typeof u=="object"&&u!==null):{"attrs"in u&&(i+=`${s}${l-1}="attrs"`);break}default:i+=u||""}}i+=n[c-1];const b=D(i.trim());return _(b,r),w(b,r),b},render:(n,r)=>{n&&!n.children.length?(n.innerHTML="",n.appendChild(r)):J(r,n,!1),p.forEach(i=>{i()}),p=[],C.forEach(i=>{i()}),C=[]}}})();class X{constructor(t,s){A(this,"_shadowRoot");A(this,"_hostElement");A(this,"update");A(this,"emitEvent");this._hostElement=t,this._shadowRoot=s}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const ge={selector:"",root:!1,styles:"",deps:[],standalone:!1,shadowDomEncapsulation:!0},Z=(e,t)=>{const s=document.createElement("style");return s.innerHTML=e,t&&t.appendChild(s),s},pe=async(e,t)=>{var s,a,h,g,p,ee,S,te,D;if(e={...ge,...e},y(e.styles)){const H=await e.styles;e.styles=H.default.toString()}if(e.styles=e.styles.toString(),e.root&&!j.isRootNodeSet)j.isRootNodeSet=!0,e.styles&&(j.globalStyles.replace(e.styles),j.globalStyleTag=Z(e.styles,document.head));else if(e.root&&j.isRootNodeSet)throw Error("Cannot register duplicate root component in "+e.selector+" component");window.customElements.define(e.selector,(D=class extends HTMLElement{constructor(){super();L(this,p);L(this,S);L(this,s,void 0);L(this,a,void 0);L(this,h,void 0);L(this,g,new B);A(this,"renderCount",0);if(e.shadowDomEncapsulation&&se)M(this,a,this.attachShadow({mode:"open"})),m(this,a).adoptedStyleSheets=j.getComputedCss(e.styles,e.standalone);else{M(this,a,this);const f=W();this.setAttribute("data-did",f);const _=e.styles.replaceAll(":host",`${e.selector}[data-did='${f}']`);!e.root&&_&&M(this,h,Z(_,document.head))}this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this),this.setRenderIntoQueue=this.setRenderIntoQueue.bind(this),U(this,p,ee).call(this)}static get observedAttributes(){return t.observedAttributes||[]}update(){const f=m(this,s).render();typeof f=="string"?m(this,a).innerHTML=ce(f):K(m(this,a),f)}setProps(f){var _,w;for(const[T,x]of Object.entries(f))t.observedProperties.find(N=>N===T)&&(m(this,s)[T]=x);(w=(_=m(this,s)).onPropertiesChanged)==null||w.call(_)}getInstance(){return m(this,s)}setRenderIntoQueue(){++this.renderCount,this.renderCount===1&&queueMicrotask(()=>{this.update(),this.renderCount=0})}connectedCallback(){var f,_,w,T;m(this,g).add($(this,"bindprops",x=>{const N=x.detail.props;N&&this.setProps(N)})),m(this,g).add($(this,"refresh_component",()=>{this.update()})),(_=(f=m(this,s)).beforeMount)==null||_.call(f),this.update(),(T=(w=m(this,s)).mount)==null||T.call(w)}attributeChangedCallback(f,_,w){var T,x;(x=(T=m(this,s)).onAttributesChanged)==null||x.call(T,f,_,w)}disconnectedCallback(){var f,_,w;this.renderCount=0,(_=(f=m(this,s)).unmount)==null||_.call(f),(w=m(this,h))==null||w.remove(),m(this,g).unsubscribe()}},s=new WeakMap,a=new WeakMap,h=new WeakMap,g=new WeakMap,p=new WeakSet,ee=function(){const f=new X(this,m(this,a));f.update=()=>{this.update()},f.emitEvent=(_,w)=>{U(this,S,te).call(this,_,w)},m(this,g).add(fe(this.setRenderIntoQueue,()=>{M(this,s,G(ae(this.setRenderIntoQueue,t),e.deps,f))}))},S=new WeakSet,te=function(f,_){const w=new CustomEvent(f,{detail:_});this.dispatchEvent(w)},D))},ye={deps:[]},me=e=>t=>{if(e.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(e.selector)||pe(e,t)},Se=(e={})=>t=>{if(e={...ye,...e},t.prototype.__metadata__={name:"SERVICE"},e.deps.some(a=>a.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const s=G(t,e.deps);Y.register(t,s)};o.BehaviourSubjectObs=ie,o.Component=me,o.Injectable=Se,o.Renderer=X,o.SubjectObs=q,o.Subscriptions=B,o.fromEvent=$,o.html=be,o.promisify=le,o.render=K,o.signal=he,o.wrapIntoObservable=oe,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
