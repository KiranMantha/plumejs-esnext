var ve=Object.defineProperty;var we=(c,d,m)=>d in c?ve(c,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):c[d]=m;var T=(c,d,m)=>(we(c,typeof d!="symbol"?d+"":d,m),m),q=(c,d,m)=>{if(!d.has(c))throw TypeError("Cannot "+m)};var p=(c,d,m)=>(q(c,d,"read from private field"),m?m.call(c):d.get(c)),N=(c,d,m)=>{if(d.has(c))throw TypeError("Cannot add the same private member more than once");d instanceof WeakSet?d.add(c):d.set(c,m)},P=(c,d,m,O)=>(q(c,d,"write to private field"),O?O.call(c,m):d.set(c,m),m);var B=(c,d,m)=>(q(c,d,"access private method"),m);(function(c,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(c=typeof globalThis<"u"?globalThis:c||self,d(c.plumejs={}))})(this,function(c){var I,te;"use strict";const d=e=>!!e&&typeof e.subscribe=="function",m=e=>!!e&&typeof e.then=="function",O=e=>{const t=e.toString().split(/constructor\s*[^\(]*\(\s*([^\)]*)\)/m);return t.length===3?t[1].split(",").map(s=>s.trim()):[]},ie=(()=>{try{return new CSSStyleSheet,!0}catch{return!1}})(),oe=e=>({subscribe:t=>{t(e)}}),ce=e=>({subscribe:t=>{Promise.resolve(e).then(s=>{t(s)})}}),W=()=>Math.random().toString(36).substring(2);class K{constructor(){T(this,"_callbackCollection",{})}unsubscribe(t){delete this._callbackCollection[t]}asObservable(){return{subscribe:t=>this.subscribe(t)}}subscribe(t){const s=W();return this._callbackCollection[s]=t,()=>this.unsubscribe(s)}next(t){for(const s in this._callbackCollection)this._callbackCollection[s](t)}}class ae extends K{constructor(s){super();T(this,"_initialValue");this._initialValue=s}subscribe(s){const a=super.subscribe(s);return super.next(this._initialValue),a}next(s){this._initialValue=s,super.next(s)}}class Y{constructor(){T(this,"_subcribers",[])}add(t){this._subcribers.push(t)}unsubscribe(){for(const t of this._subcribers)t();this._subcribers=[]}}const le=e=>d(e)?e:m(e)?ce(Promise.resolve(e)):oe(e),$=(e,t,s,a=!1)=>(e.addEventListener(t,s,a),()=>{e.removeEventListener(t,s,a)}),ue=e=>{const t=()=>new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),s=y=>{const v=y.querySelectorAll("script");for(const A of v)A.remove()},a=(y,v)=>{if(v=v.replace(/\s+/g,"").toLowerCase(),["src","href","xlink:href"].includes(y)&&(v.includes("javascript:")||v.includes("data:"))||y.startsWith("on"))return!0},f=y=>{const v=y.attributes;for(const{name:A,value:J}of v)a(A,J)&&y.removeAttribute(A)},g=y=>{const v=y.children;for(const A of v)f(A),g(A)},b=t();return s(b),g(b),b.innerHTML},de=(e,t)=>{const s=O(t),a=()=>({get(f,g){const b=Object.prototype.toString.call(f[g]);return["[object Object]","[object Array]"].indexOf(b)>-1&&!("__metadata__"in f[g])?new Proxy(f[g],a()):f[g]},set(f,g,b){return f[g]=b,e(),!0}});return class extends t{constructor(...f){return super(...f),f.forEach((g,b)=>{s[b]&&s[b]!=="undefined"&&(this[s[b]]=g)}),new Proxy(this,a())}}},he=()=>{let e;return[new Promise(s=>{e=s}),e]},fe=e=>typeof e=="function",Q=Object.create(null);let L=null;function be(e,t){const s=L;let a;L=W(),Q[L]=e;try{t()}finally{a=L,L=s}return a}function ge(e){const t=Q[L];let s=e;function a(){return s}return a.set=function(f){fe(f)?s=f(s):s=f;try{t()}catch{}},a}function ye(e,t){const s=be(e,t);return function(){delete Q[s]}}const G=new(te=class{constructor(){N(this,I,void 0);P(this,I,new WeakMap)}register(e,t){if(!p(this,I).get(e))p(this,I).set(e,t);else throw console.error(e),"service already exists"}getService(e){const t=p(this,I).get(e);if(t)return t;throw console.error(e),"service is not a registered service."}clear(){P(this,I,new WeakMap)}},I=new WeakMap,te),X=(e,t,s)=>{if(t.length>0){const a=[];for(const b of t)b.prototype.__metadata__.name!=="RENDERER"?a.push(G.getService(b)):a.push(s);const f=O(e),g=new e(...a);return t.forEach((b,y)=>{g[f[y]]=a[y]}),g}else return new e},M=new class{constructor(){T(this,"globalStyles");T(this,"globalStyleTag");T(this,"style_registry");T(this,"isRootNodeSet");try{this.globalStyles=new CSSStyleSheet}catch{this.globalStyles=""}this.isRootNodeSet=!1,this.globalStyleTag=null}getComputedCss(e=""){let t=[];const s=new CSSStyleSheet;if(s.insertRule(":host { display: block; }"),t=[this.globalStyles,s],e){const a=new CSSStyleSheet;a.replace(e),t.push(a)}return t}},{html:pe,render:Z}=(()=>{const e=/([^\s\\>"'=]+)\s*=\s*(['"]?)$/,t=/<[a-z][^>]+$/i,s="attr",a=/^attr([^ ]+)/,f="insertNode",g=/^insertNode([^ ]+)/;let b=[],y=[];const v=n=>{const r={"&":"&amp;","<":"&lt;",">":"&gt;","(":"%28",")":"%29"};let i=JSON.stringify(n);const o=u=>r[u]||u;return i=(u=>u.replace(/[&<>\(\)]/g,o))(i),JSON.parse(i)},A=(n,r)=>{const i=n.options,o=Array.isArray(r)?r:[r];let h,u,l=i.length;for(;l--;){u=i[l];const w=u.getAttribute("value")??(u.textContent.match(/[^\x20\t\r\n\f]+/g)||[]).join(" ");(u.selected=o.indexOf(w)>-1)&&(h=!0)}h||(n.selectedIndex=-1)},J=n=>{const r=document.createElement("template");return r.innerHTML=n,r.content},j=(n,r,i)=>{const o=()=>{setTimeout(()=>{if(n.isConnected){const h=new CustomEvent("bindprops",{detail:{props:r},bubbles:!1});n.dispatchEvent(h)}})};n[i]=JSON.stringify(r),y.push(o)},D=(n,r,i)=>{switch(!0){case/attrs/.test(r):{const o=i.attrs;for(const h in o)D(n,h,o[h]);break}case/^on+/.test(r):{const o=r.slice(2).toLowerCase();n.removeEventListener(o,i),n.addEventListener(o,i);break}case/ref/.test(r):{const o=function(){this.node.isConnected&&this.fn(this.node)}.bind({node:n,fn:i});b.push(o);break}case/key/.test(r):{n[Symbol("key")]=i;break}case/^data-+/.test(r):case/^aria-+/.test(r):{r==="data-input"?j(n,i,Symbol("input")):n.setAttribute(r,v(i));break}case/class/.test(r):{i?n.classList.add(...i.split(" ")):n.setAttribute("class","");break}case/value/.test(r):{n.nodeName.toLowerCase()==="select"?A(n,i):n.value=v(i);break}case/disabled/.test(r):case/checked/.test(r):{i?n.setAttribute(r,i):n.removeAttribute(r);break}default:n.setAttribute(r,v(i))}},S=(n,r)=>{const i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,null);let o=i.nextNode();for(;o;){if(o.hasAttributes()){const h=Array.from(o.attributes).filter(u=>a.test(u.nodeName));for(const{nodeName:u,nodeValue:l}of h){const w=a.exec(u)[1];D(o,l,r[w]),o.removeAttribute(u)}}o=i.nextNode()}},E=(n,r)=>{const i=document.createTreeWalker(n,NodeFilter.SHOW_COMMENT,null);let o=i.nextNode(),h;for(;o;){if(h=g.exec(o.data)){const u=Array.isArray(r[h[1]])?r[h[1]]:[r[h[1]]];o.replaceWith(...u),i.currentNode=n}o=i.nextNode()}},_=(n,r)=>{if(!n)return[null,""];const i=Object.getOwnPropertySymbols(n).find(h=>h.description===r),o=i?n[i]:"";return[i,o]},k=(n,r)=>{if(!n||!r||n.nodeType!==1||r.nodeType!==1)return;const i=n.attributes,o=r.attributes,h=r.getAttribute("data-preserve-attributes"),u=h&&h==="true";for(const{name:l,value:w}of i)(!o[l]||o[l]!==w)&&r.setAttribute(l,w);if(!u)for(const{name:l}of o)i[l]||r.removeAttribute(l);if(["input","textarea"].includes(r.tagName.toLowerCase())&&(r.value=n.value),r.tagName.indexOf("-")>-1&&n.tagName.indexOf("-")>-1){const l=_(n,"input")[1],w=_(r,"input");l&&w[1]&&l!==w[1]&&j(r,JSON.parse(l),w[0])}},R=n=>n.nodeType===3?"text":n.nodeType===8?"comment":n.tagName.toLowerCase(),x=n=>n.childNodes&&n.childNodes.length>0?null:n.textContent,z=(n,r,i)=>{const o=r?Array.from(r.childNodes):[],h=n?Array.from(n.childNodes):[];let u=o.length-h.length;if(u>0)for(;u>0;u--)o[o.length-u].parentNode.removeChild(o[o.length-u]);h.forEach(function(l,w){const C=o[w],H=_(l,"key")[1],F=_(C,"key")[1];if(k(l,C),i&&C&&C.nodeType===1&&C.tagName.indexOf("-")>-1)return;if(!C){r&&r.appendChild(l);return}if(H&&F&&H!==F||R(l)!==R(C)){C.replaceWith(l);return}const U=x(l);if(U&&U!==x(C)){C.textContent=U;return}if(C.childNodes.length>0&&l.childNodes.length<1){C.innerHTML="";return}if(C.childNodes.length<1&&l.childNodes.length>0){const se=document.createDocumentFragment();z(l,se,!1),C.appendChild(se);return}if(l.childNodes.length>0){z(l,C,!0);return}})};return{html:(n,...r)=>{let i="";const{length:o}=n;for(let u=1;u<o;u++){const l=r[u-1];let w=!1;if(i+=n[u-1],e.test(i)&&t.test(i)&&(i=i.replace(e,(C,H,F)=>`${s}${u-1}=${F||'"'}${H}${F?"":'"'}`),w=!0),!w)switch(!0){case Array.isArray(l):case l instanceof DocumentFragment:{i+=`<!--${f}${u-1}-->`;break}case(typeof l=="object"&&l!==null):{"attrs"in l&&(i+=`${s}${u-1}="attrs"`);break}default:i+=l||""}}i+=n[o-1];const h=J(i.trim());return S(h,r),E(h,r),h},render:(n,r)=>{n&&!n.children.length?(n.innerHTML="",n.appendChild(r)):z(r,n,!1),b.forEach(i=>{i()}),b=[],y.forEach(i=>{i()}),y=[]}}})();class V{constructor(t,s){T(this,"_shadowRoot");T(this,"_hostElement");T(this,"update");T(this,"emitEvent");this._hostElement=t,this._shadowRoot=s}get __metadata__(){return{name:"RENDERER"}}get shadowRoot(){return this._shadowRoot}get hostElement(){return this._hostElement}}const me={selector:"",root:!1,styles:"",deps:[],standalone:!1,shadowDomEncapsulation:!0},ee=(e,t)=>{const s=document.createElement("style");return s.innerHTML=e,t&&t.appendChild(s),s},Se=async(e,t)=>{var s,a,f,g,b,y,ne,A,re,j;if(e={...me,...e},m(e.styles)){const D=await e.styles;e.styles=D.default.toString()}if(e.styles=e.styles.toString(),e.root&&!M.isRootNodeSet)M.isRootNodeSet=!0,e.styles&&(M.globalStyles.replace(e.styles),M.globalStyleTag=ee(e.styles,document.head));else if(e.root&&M.isRootNodeSet)throw Error("Cannot register duplicate root component in "+e.selector+" component");window.customElements.define(e.selector,(j=class extends HTMLElement{constructor(){super();N(this,y);N(this,A);N(this,s,void 0);N(this,a,void 0);N(this,f,void 0);N(this,g,new Y);N(this,b,!1);T(this,"renderCount",0);e.shadowDomEncapsulation&&ie?(P(this,b,!1),P(this,a,this.attachShadow({mode:"open"})),p(this,a).adoptedStyleSheets=M.getComputedCss(e.styles,e.standalone)):(P(this,b,!0),P(this,a,this)),this.getInstance=this.getInstance.bind(this),this.update=this.update.bind(this),this.setRenderIntoQueue=this.setRenderIntoQueue.bind(this),B(this,y,ne).call(this)}static get observedAttributes(){return t.observedAttributes||[]}update(){const S=p(this,s).render();typeof S=="string"?p(this,a).innerHTML=ue(S):Z(p(this,a),S)}setProps(S){var E,_;for(const[k,R]of Object.entries(S))t.observedProperties.find(x=>x===k)&&(p(this,s)[k]=R);(_=(E=p(this,s)).onPropertiesChanged)==null||_.call(E)}getInstance(){return p(this,s)}setRenderIntoQueue(){++this.renderCount,this.renderCount===1&&queueMicrotask(()=>{this.update(),this.renderCount=0})}connectedCallback(){var S,E,_,k;if(p(this,b)){const R=W();this.setAttribute("data-did",R);const x=e.styles.replaceAll(":host",`${e.selector}[data-did='${R}']`);!e.root&&x&&P(this,f,ee(x,document.head))}p(this,g).add($(this,"bindprops",R=>{const x=R.detail.props;x&&this.setProps(x)})),p(this,g).add($(this,"refresh_component",()=>{this.update()})),(E=(S=p(this,s)).beforeMount)==null||E.call(S),this.update(),(k=(_=p(this,s)).mount)==null||k.call(_)}attributeChangedCallback(S,E,_){var k,R;(R=(k=p(this,s)).onAttributesChanged)==null||R.call(k,S,E,_)}disconnectedCallback(){var S,E,_;this.renderCount=0,(E=(S=p(this,s)).unmount)==null||E.call(S),(_=p(this,f))==null||_.remove(),p(this,g).unsubscribe()}},s=new WeakMap,a=new WeakMap,f=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakSet,ne=function(){const S=new V(this,p(this,a));S.update=()=>{this.update()},S.emitEvent=(E,_)=>{B(this,A,re).call(this,E,_)},p(this,g).add(ye(this.setRenderIntoQueue,()=>{P(this,s,X(de(this.setRenderIntoQueue,t),e.deps,S))}))},A=new WeakSet,re=function(S,E){const _=new CustomEvent(S,{detail:E});this.dispatchEvent(_)},j))},_e={deps:[]},Ee=e=>t=>{if(e.selector.indexOf("-")<=0)throw new Error("You need at least 1 dash in the custom element name!");window.customElements.get(e.selector)||Se(e,t)},Ce=(e={})=>t=>{if(e={..._e,...e},t.prototype.__metadata__={name:"SERVICE"},e.deps.some(a=>a.prototype.__metadata__.name==="RENDERER"))throw Error("Renderer cannot be a dependency for a service. It should be used with component");const s=X(t,e.deps);G.register(t,s)};c.BehaviourSubjectObs=ae,c.Component=Ee,c.Injectable=Ce,c.Renderer=V,c.SubjectObs=K,c.Subscriptions=Y,c.fromEvent=$,c.html=pe,c.promisify=he,c.render=Z,c.signal=ge,c.wrapIntoObservable=le,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
